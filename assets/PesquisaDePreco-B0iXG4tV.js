import{a as P}from"./axios-B7aoVuMY.js";import{N as K}from"./NavBar-DPjC25Eh.js";import{C as M,U as A}from"./utilsService-YId4AcU1.js";import{_ as C,r as f,o as u,c as D,t as g,b as o,w as a,a as r,C as F,d as n,F as q,v as B,j as $,i as j,g as d,K as S,L as z,M as L,f as b,H as h,z as p,u as k,s as G,l as Q,P as W,p as w,O as U,Q as X,D as Y,R as Z,e as O,m as ee,T,J as N,U as _}from"./index-BnP5vbA0.js";import{B as te}from"./BtnComeBack-Brlz_N_3.js";const ae={name:"MoneyInput",data:()=>({options:{prefix:"R$",decimal:",",thousands:".",precision:"2",masked:!1}})};function oe(e,t,s,E,R,i){const v=f("vuetify-money");return u(),D(v,{options:e.options},null,8,["options"])}const H=C(ae,[["render",oe]]),se={name:"NovaPesquisa",components:{ConfirmButton:M,MoneyInput:H},props:{onSubmit:Function,currentItem:{type:Object},dialogAtivo:{type:Boolean,required:!0}},data:()=>({isSubmitting:!1,products:[],requiredField:[e=>e!=null&&e!==""||"Obrigatório"]}),watch:{dialogAtivo(e){e||this.resetState()}},computed:{isFormValid(){return!!this.currentItem.produtoId}},methods:{resetState(){Object.keys(this.currentItem).forEach(e=>{e==="precos"?this.currentItem[e]=this.currentItem[e].map(()=>null):this.currentItem[e]=null})},async getProducts(){try{const e=await P.get("/public/produtos");console.log(e.data),Array.isArray(e.data)?this.products=e.data:(console.log("A resposta da API não é um Array"),this.products=[])}catch(e){console.log("Error: ",e),this.products=[]}},async localOnSubmit(){try{this.currentItem.dataPesquisa=new Date;const e={...this.currentItem};console.log(e),this.onSubmit(e)}catch(e){console.log("Erro: ",e)}}},mounted(){this.getProducts()}},re={class:"pa-4 pr-12 pl-12"},le={class:"grid-container"};function ie(e,t,s,E,R,i){const v=f("MoneyInput"),y=f("ConfirmButton");return u(),g("div",re,[o(j,{onSubmit:$(i.localOnSubmit,["prevent"]),ref:"formRef"},{default:a(()=>[r("div",le,[o(F,{density:"compact",name:"products",items:e.products,"item-title":"descricao","item-value":"id",modelValue:s.currentItem.produtoId,"onUpdate:modelValue":t[0]||(t[0]=c=>s.currentItem.produtoId=c),rules:e.requiredField,variant:"outlined"},{label:a(()=>t[1]||(t[1]=[r("span",null,[n("Produto "),r("span",{style:{color:"red"}},"*")],-1)])),_:1},8,["items","modelValue","rules"]),(u(!0),g(q,null,B(s.currentItem.precos,(c,m)=>(u(),g("div",{key:m},[o(v,{modelValue:s.currentItem.precos[m],"onUpdate:modelValue":I=>s.currentItem.precos[m]=I,style:{width:"120px"},type:"number",label:`Preço ${m+1}`,density:"compact",variant:"outlined",placeholder:`Preço ${m+1}`},null,8,["modelValue","onUpdate:modelValue","label","placeholder"])]))),128))])]),_:1},8,["onSubmit"]),o(b,{class:"justify-end dense pt-6"},{default:a(()=>[o(d,{class:"text-end"},{default:a(()=>[o(S,{location:"top",disabled:i.isFormValid},{activator:a(({props:c})=>[r("span",z(L(c)),[o(y,{color:i.isFormValid?"success":"grey",onConfirm:i.localOnSubmit,loading:e.isSubmitting,disabled:!i.isFormValid||e.isSubmitting},{default:a(()=>t[2]||(t[2]=[n("Salvar")])),_:1},8,["color","onConfirm","loading","disabled"])],16)]),default:a(()=>[t[3]||(t[3]=r("span",null,"Preencha todos os campos obrigatórios (*) para habilitar o botão",-1))]),_:1},8,["disabled"])]),_:1})]),_:1})])}const ne=C(se,[["render",ie],["__scopeId","data-v-5202ae2e"]]),de={name:"EditProduto",components:{ConfirmButton:M,MoneyInput:H},props:{onSubmit:Function,currentItem:{type:Object}},data:()=>({isSubmitting:!1,products:[],requiredField:[e=>e!=null&&e!==""||"Obrigatório"]}),computed:{isFormValid(){return!!this.currentItem.produto.descricao}},methods:{parseReal(e){return e=A.parseReal(e),e},async getProducts(){try{const e=await P.get("/public/produtos");console.log(e.data),Array.isArray(e.data)?this.products=e.data:(console.log("A resposta da API não é um Array"),this.products=[])}catch(e){console.log("Error: ",e),this.products=[]}},async localOnSubmit(){try{const e={...this.currentItem};this.onSubmit(e)}catch(e){console.log("Erro: ",e)}}},mounted(){this.getProducts(),this.currentItem&&this.currentItem.precos&&this.currentItem.precos.forEach((e,t)=>{e.valor=this.parseReal(e.valor)})}},ue={class:"pa-4 pr-12 pl-12"},ce={class:"grid-container"};function pe(e,t,s,E,R,i){const v=f("MoneyInput"),y=f("ConfirmButton");return u(),g("div",ue,[o(j,{onSubmit:$(i.localOnSubmit,["prevent"]),ref:"formRef"},{default:a(()=>[r("div",ce,[o(F,{density:"compact",name:"products",items:e.products,"item-title":"descricao","item-value":"id",modelValue:s.currentItem.produto.descricao,"onUpdate:modelValue":t[0]||(t[0]=c=>s.currentItem.produto.descricao=c),variant:"outlined"},{label:a(()=>t[1]||(t[1]=[r("span",null,[n("Produto "),r("span",{style:{color:"red"}},"*")],-1)])),_:1},8,["items","modelValue"]),(u(!0),g(q,null,B(s.currentItem.precos,(c,m)=>(u(),g("div",{key:m},[o(v,{modelValue:c.valor,"onUpdate:modelValue":I=>c.valor=I,style:{width:"120px"},type:"number",label:`Preço ${m+1}`,density:"compact",variant:"outlined",placeholder:`Preço ${m+1}`},null,8,["modelValue","onUpdate:modelValue","label","placeholder"])]))),128))])]),_:1},8,["onSubmit"]),o(b,{class:"justify-end dense pt-6"},{default:a(()=>[o(d,{class:"text-end"},{default:a(()=>[o(S,{location:"top",disabled:i.isFormValid},{activator:a(({props:c})=>[r("span",z(L(c)),[o(y,{color:i.isFormValid?"success":"grey",onConfirm:i.localOnSubmit,loading:e.isSubmitting,disabled:!i.isFormValid||e.isSubmitting},{default:a(()=>t[2]||(t[2]=[n("Salvar")])),_:1},8,["color","onConfirm","loading","disabled"])],16)]),default:a(()=>[t[3]||(t[3]=r("span",null,"Preencha todos os campos obrigatórios (*) para habilitar o botão",-1))]),_:1},8,["disabled"])]),_:1})]),_:1})])}const me=C(de,[["render",pe],["__scopeId","data-v-1801e0c3"]]),fe={name:"ProdutorExpand",props:{pesquisaData:Object},data:()=>({productors:[],headers:[{title:"Arquivo",align:"start",sortable:!0,value:"fileName"},{title:"Tipo",align:"start",sortable:!0,value:"fileType"},{title:"Baixar",align:"start",sortable:!0,value:"download"},{title:"Remover",align:"start",sortable:!0,value:"remove"}]}),methods:{formatPrice(e){return e=A.formatReal(e),e},formatDateBr(e){return A.formatDateBr(e)}}},ge={align:"start",class:"pa-2"},ve={align:"start",class:"pa-2"};function he(e,t,s,E,R,i){return u(),g(q,null,[t[10]||(t[10]=r("h3",{class:"mt-2"},"Detalhes da Pesquisa de Preço",-1)),r("h4",ge,[t[1]||(t[1]=n(" Dados do Produto ")),o(h,null,{default:a(()=>t[0]||(t[0]=[n("mdi-corn")])),_:1})]),o(b,{dense:"",style:{height:"100px"},class:"border-md pa-2 ga-6"},{default:a(()=>[o(d,{cols:"auto",align:"start",class:"h-50"},{default:a(()=>[t[2]||(t[2]=r("h4",null,"ID:",-1)),r("p",null,p(s.pesquisaData.produto.id),1)]),_:1}),o(d,{cols:"auto",align:"start",class:"h-50"},{default:a(()=>[t[3]||(t[3]=r("h4",null,"Descrição:",-1)),r("p",null,p(s.pesquisaData.produto.descricao),1)]),_:1}),o(d,{cols:"1",align:"start",class:"h-50"},{default:a(()=>[t[4]||(t[4]=r("h4",null,"Unidade:",-1)),r("p",null,p(s.pesquisaData.produto.unidade),1)]),_:1}),o(d,{cols:"3",align:"start",class:"h-50"},{default:a(()=>[t[5]||(t[5]=r("h4",null,"Preço Médio:",-1)),r("p",null,p(i.formatPrice(s.pesquisaData.produto.precoMedio)),1)]),_:1})]),_:1}),r("h4",ve,[t[7]||(t[7]=n(" Dados da Pesquisa ")),o(h,null,{default:a(()=>t[6]||(t[6]=[n("mdi-note-search")])),_:1})]),o(b,{dense:"",style:{height:"100px"},class:"border-md pa-2 ga-6 mb-2"},{default:a(()=>[o(d,{cols:"auto",align:"start",class:"h-75"},{default:a(()=>[t[8]||(t[8]=r("h4",null,"ID:",-1)),r("p",null,p(s.pesquisaData.id),1)]),_:1}),(u(!0),g(q,null,B(s.pesquisaData.precos,(v,y)=>(u(),D(d,{cols:"auto",align:"start",class:"h-75",key:y},{default:a(()=>[r("h4",null,"Preço "+p(y+1)+":",1),r("p",null,p(v.valor),1)]),_:2},1024))),128)),o(d,{cols:"auto",align:"start",class:"h-75"},{default:a(()=>[t[9]||(t[9]=r("h4",null,"Data da Pesquisa:",-1)),r("p",null,p(i.formatDateBr(s.pesquisaData.dataPesquisa)),1)]),_:1})]),_:1})],64)}const ye=C(fe,[["render",he]]),be={name:"PesquisaDePreco",components:{NavBar:K,NovaPesquisa:ne,ProdutorExpand:ye,EditPesquisa:me,BtnComeBack:te,ConfirmButton:M},data:()=>({dialog:{create:!1,update:!1},search:"",showFilters:!1,singleExpand:!1,showFilters:!1,products:[],research:[],filtered:[],unidade:[{type:"G",value:"G"},{type:"Kg",value:"Kg"},{type:"T",value:"T"},{type:"L",value:"L"},{type:"Ml",value:"Ml"},{type:"UND",value:"Und"},{type:"Maço",value:"Maço"},{type:"Caixas",value:"Caixas"},{type:"Pacotes",value:"Pacotes"},{type:"Fardos",value:"Fardos"},{type:"Sacos",value:"Sacos"}],headers:[{text:"Editar",align:"center",value:"edit",width:"50px"},{text:"Remover",align:"center",value:"delete",width:"50px"},{title:"Produto",align:"center",sortable:!0,value:"produto.descricao"},{title:"Unidade",align:"center",sortable:!0,value:"produto.unidade"}],newItem:{precos:[null,null,null]},selectedRow:{},expanded:[],filterActive:!1,filters:{product:{value:null,compareType:"equal",prop:"produto.descricao"},unidade:{value:null,compareType:"equal",prop:"produto.unidade"},data:{value:null,compareType:"equal",prop:"dataPesquisa"}}}),watch:{"currentItem.precos":{handler(e){e.forEach((t,s)=>{t.valor=this.parseReal(t.valor)})},deep:!0}},computed:{filteredResearch(){return this.research.filter(e=>this.filters.product.value?e.produto.descricao===this.filters.product.value:!0).filter(e=>this.filters.unidade.value?e.produto.unidade===this.filters.unidade.value:!0)},dinamycHeaders(){const e=[...this.headers];if(this.research.length>0&&Array.isArray(this.research[0].precos)){const t=this.research[0].precos.length;for(let s=0;s<t;s++)e.push({title:`Preço ${s+1}`,align:"center",value:`precos[${s}].valor`});e.push({title:"Preço Médio",align:"center",value:"precoMedio"})}return e}},methods:{onExpand(e){this.expanded=e.length>0?[e[e.length-1]]:[]},formatPrice(e){return e=A.formatReal(e),e},applyFilters(){this.filterActive=!0,this.filtered=this.research.filter(e=>Object.keys(this.filters).every(t=>{const s=this.filters[t];return s.value!==null&&s.value!==""&&s.compareType==="equal"?e[s.prop]===s.value:!0}))},clearFilters(){Object.keys(this.filters).forEach(e=>{this.filters[e].value=null}),this.filterActive=!1,this.filtered=[]},async getResearch(){try{const e=await P.get("/public/pesquisas");console.log("Resposta da Api: ",e.data),Array.isArray(e.data)?(this.research=e.data,this.research.forEach(t=>{t.precos.forEach(s=>{s.valor=this.formatPrice(s.valor)})})):(console.log("A resposta da API não é um Array"),this.research=[])}catch(e){console.log("Error: ",e),this.research=[]}},async createProduct(e){const t=k();console.log(e);try{const s=await P.post("/public/pesquisas/pesquisa",e);if(console.log(s.data),s.status!==201)throw new Error(`Erro: ${s.status}`);t.success("Pesquisa cadastrada com sucesso!")}catch(s){console.error("Erro: ",s),t.error("Erro ao cadastrar pesquisa: ",s)}finally{this.dialog.create=!1,this.getResearch()}},async updateProduct(e){console.log(e);const t=k();try{const s=await P.put(`/public/pesquisas/pesquisa/${e.id}`,e);if(console.log(s.data),s.status!==200)throw new Error(`Erro: ${s.status}`);t.success("Pesquisa atualizada com sucesso!")}catch(s){console.error("Erro: ",s),t.error("Erro ao atualizar a pesquisa: ",s)}finally{this.dialog.update=!1,this.getResearch()}},async getProducts(){try{const e=await P.get("/public/produtos");console.log(e.data),Array.isArray(e.data)?this.products=e.data:(console.log("A resposta da API não é um Array"),this.products=[])}catch(e){console.log("Error: ",e),this.products=[]}},async deletePesquisa(e){const t=k();try{const s=await P.delete(`/public/pesquisas/pesquisa/${e.id}`,e);if(s.status!==204)throw new Error("Erro: ",s.status);t.success("Pesquisa removida com sucesso!")}catch(s){t.error("Erro ao deletar pesquisa: ",s),console.error("Erro: ",s)}finally{this.getProducts()}},onSelectRow(e,t){console.log("Linha selecionada: ",this.selectedRow),t==="update"&&(this.selectedRow=JSON.parse(JSON.stringify({...e})),this.dialog.update=!0)},onDeleteRow(e){this.selectedRow={...e},this.deletePesquisa(this.selectedRow)}},mounted(){this.getResearch(),this.getProducts()}},Pe={colspan:9,style:{"background-color":"#37622a"},class:"text-white"};function qe(e,t,s,E,R,i){const v=f("NavBar"),y=f("BtnComeBack"),c=f("ConfirmButton"),m=f("ProdutorExpand"),I=f("NovaPesquisa"),J=f("EditPesquisa");return u(),g(q,null,[o(v),o(y),t[26]||(t[26]=r("h1",{style:{color:"#57a340","margin-top":"10px",padding:"30px","font-size":"3rem"}},"Pesquisa De Preço",-1)),o(b,{justify:"center",class:"pr-2"},{default:a(()=>[o(d,{cols:"12"},{default:a(()=>[o(G,{items:i.filteredResearch,headers:i.dinamycHeaders,search:e.search,"show-expand":"",expanded:e.expanded,"onUpdate:expanded":[t[5]||(t[5]=l=>e.expanded=l),i.onExpand],"fixed-header":!0,height:"700px"},{top:a(()=>[o(b,{class:"mt-2 mb-8 mx-3"},{default:a(()=>[o(d,{cols:"5"},{default:a(()=>[o(Q,{class:"border rounded",dense:"",outlined:"","hide-details":"",modelValue:e.search,"onUpdate:modelValue":t[0]||(t[0]=l=>e.search=l),label:"Pesquisar","append-inner-icon":"mdi-magnify",clearable:""},null,8,["modelValue"])]),_:1}),o(d,{class:"text-end",cols:"2"},{default:a(()=>[o(W,{location:"top start",bordered:"",overlap:""},{default:a(()=>[o(w,{class:"elevation-0",onClick:t[1]||(t[1]=l=>e.showFilters=!e.showFilters)},{default:a(()=>[e.showFilters?(u(),D(h,{key:1,left:"",size:"25px"},{default:a(()=>t[11]||(t[11]=[n("mdi-filter-off")])),_:1})):(u(),D(h,{key:0,size:"25px",left:""},{default:a(()=>t[10]||(t[10]=[n("mdi-filter")])),_:1})),t[12]||(t[12]=n(" FILTROS "))]),_:1})]),_:1})]),_:1}),o(d,{class:"button-group mr-4",align:"end"},{default:a(()=>[o(S,{location:"top"},{activator:a(({props:l})=>[o(w,U({color:"success",class:"elevation-3 compact-btn ml-3","min-width":"25%",onClick:t[2]||(t[2]=V=>e.dialog.create=!0)},l),{default:a(()=>[o(h,{small:"",class:"compact-icon",left:""},{default:a(()=>t[13]||(t[13]=[n("mdi-plus")])),_:1}),t[14]||(t[14]=r("div",{class:"d-flex flex-column compact-btn-text",style:{"font-size":"0.6rem"}},[r("span",null,"Nova"),n(),r("span",null,"Pesquisa")],-1))]),_:2},1040)]),default:a(()=>[t[15]||(t[15]=r("span",null,"Clique para adicionar uma pesquisa",-1))]),_:1})]),_:1}),o(d,{cols:"12"},{default:a(()=>[o(X,null,{default:a(()=>[Y(o(O,{variant:"outlined",height:"150px"},{default:a(()=>[t[17]||(t[17]=r("h4",{class:"ml-4 mt-4",align:"start"},"Filtrar por",-1)),o(b,{dense:"",class:"py-2 px-4"},{default:a(()=>[o(d,{cols:2},{default:a(()=>[o(F,{density:"compact",variant:"outlined",items:e.products,label:"Produto","item-title":"descricao","item-value":"descricao",modelValue:e.filters.product.value,"onUpdate:modelValue":t[3]||(t[3]=l=>e.filters.product.value=l),outlined:"",dense:""},null,8,["items","modelValue"])]),_:1}),o(d,{cols:4},{default:a(()=>[o(F,{density:"compact",variant:"outlined",items:e.unidade,label:"Unidade","item-title":"type","item-value":"value",modelValue:e.filters.unidade.value,"onUpdate:modelValue":t[4]||(t[4]=l=>e.filters.unidade.value=l)},null,8,["items","modelValue"])]),_:1})]),_:1}),o(ee,null,{default:a(()=>[o(b,{dense:""},{default:a(()=>[o(d,{class:"text-end",height:"200"},{default:a(()=>[o(w,{align:"start",justify:"center",class:"pb-8",color:"error",text:"",elevation:"0",onClick:i.clearFilters},{default:a(()=>t[16]||(t[16]=[n(" Limpar filtros ")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},512),[[Z,e.showFilters]])]),_:1})]),_:1})]),_:1})]),"item.edit":a(({item:l})=>[o(S,{location:"top"},{activator:a(({props:V})=>[o(w,U({icon:""},V,{onClick:x=>i.onSelectRow(l,"update"),class:"elevation-0"}),{default:a(()=>[o(h,{color:"green"},{default:a(()=>t[18]||(t[18]=[n("mdi-pencil")])),_:1})]),_:2},1040,["onClick"])]),default:a(()=>[t[19]||(t[19]=r("span",null,"Clique para editar um Produtor",-1))]),_:2},1024)]),"item.delete":a(({item:l})=>[o(S,{location:"top"},{activator:a(({props:V})=>[o(c,U({icon:""},V,{onConfirm:()=>i.onDeleteRow(l),class:"elevation-0"}),{default:a(()=>[o(h,{color:"red"},{default:a(()=>t[20]||(t[20]=[n("mdi-delete")])),_:1})]),_:2},1040,["onConfirm"])]),default:a(()=>[t[21]||(t[21]=r("span",null,"Clique para deletar um Produtor",-1))]),_:2},1024)]),"expanded-row":a(({item:l})=>[r("tr",null,[r("td",Pe,[n(p(console.log(l))+" ",1),o(m,{pesquisaData:l},null,8,["pesquisaData"])])])]),"item.precos":a(({item:l})=>[n(p(console.log(l.precos))+" ",1),(u(!0),g(q,null,B(l.precos,(V,x)=>(u(),g(q,{key:x},[r("span",null,p(V.valor),1),t[22]||(t[22]=r("span",null,"-",-1))],64))),128))]),"item.precoMedio":a(({item:l})=>[r("span",null,p(i.formatPrice(l.precoMedio)),1)]),_:2},1032,["items","headers","search","expanded","onUpdate:expanded"]),o(T,{modelValue:e.dialog.create,"onUpdate:modelValue":t[7]||(t[7]=l=>e.dialog.create=l)},{default:a(()=>[o(O,{class:"card-form align-self-center",width:"60%"},{default:a(()=>[o(N,{class:"sticky-title title-border"},{default:a(()=>[t[24]||(t[24]=n(" Cadastro de Produto ")),o(_),o(w,{icon:"",class:"btn-close elevation-0",onClick:t[6]||(t[6]=l=>e.dialog.create=!1)},{default:a(()=>[o(h,{prepend:""},{default:a(()=>t[23]||(t[23]=[n(" mdi-close ")])),_:1})]),_:1})]),_:1}),o(I,{currentItem:e.newItem,onSubmit:i.createProduct,dialogAtivo:e.dialog.create},null,8,["currentItem","onSubmit","dialogAtivo"])]),_:1})]),_:1},8,["modelValue"]),o(T,{modelValue:e.dialog.update,"onUpdate:modelValue":t[9]||(t[9]=l=>e.dialog.update=l)},{default:a(()=>[o(O,{class:"card-form align-self-center",width:"60%"},{default:a(()=>[o(N,{class:"sticky-title title-border"},{default:a(()=>[n(" Editar Produtor: "+p(e.selectedRow.id)+" ",1),o(_),o(w,{icon:"",class:"btn-close elevation-0",onClick:t[8]||(t[8]=l=>e.dialog.update=!1)},{default:a(()=>[o(h,{prepend:""},{default:a(()=>t[25]||(t[25]=[n(" mdi-close ")])),_:1})]),_:1})]),_:1}),o(J,{currentItem:e.selectedRow,onSubmit:i.updateProduct},null,8,["currentItem","onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})],64)}const Ee=C(be,[["render",qe],["__scopeId","data-v-c9f132fa"]]);export{Ee as default};
