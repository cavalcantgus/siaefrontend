import{a as q}from"./axios-B7aoVuMY.js";import{N as J}from"./NavBar-BShwAm9u.js";import{C as $,B as K}from"./BtnComeBack-B8TkPntt.js";import{_ as w,r as g,o as u,c as A,t as f,b as a,w as o,a as r,C as D,d as n,F as P,v as k,j as _,i as j,g as d,K as F,L as z,M as L,f as b,H as h,z as c,u as O,s as G,l as Q,P as W,p as V,O as T,Q as X,D as Y,R as Z,e as B,m as ee,S as N,J as x,T as M}from"./index-fQIQvg1H.js";import{U as R}from"./utilsService-D61Juas6.js";const te={name:"MoneyInput",data:()=>({options:{prefix:"R$",decimal:",",thousands:".",precision:"2",masked:!1}})};function ae(e,t,s,S,C,i){const v=g("vuetify-money");return u(),A(v,{options:e.options},null,8,["options"])}const H=w(te,[["render",ae]]),oe={name:"NovaPesquisa",components:{ConfirmButton:$,MoneyInput:H},props:{onSubmit:Function,currentItem:{type:Object},dialogAtivo:{type:Boolean,required:!0}},data:()=>({isSubmitting:!1,products:[],requiredField:[e=>e!=null&&e!==""||"Obrigatório"]}),watch:{dialogAtivo(e){e||this.resetState()}},computed:{isFormValid(){return!!this.currentItem.produtoId}},methods:{resetState(){Object.keys(this.currentItem).forEach(e=>{this.currentItem[e]=null})},async getProducts(){try{const e=await q.get("/public/produtos");console.log(e.data),Array.isArray(e.data)?this.products=e.data:(console.log("A resposta da API não é um Array"),this.products=[])}catch(e){console.log("Error: ",e),this.products=[]}},async localOnSubmit(){try{this.currentItem.dataPesquisa=new Date;const e={...this.currentItem};console.log(e),this.onSubmit(e)}catch(e){console.log("Erro: ",e)}}},mounted(){this.getProducts()}},se={class:"pa-4 pr-12 pl-12"},re={class:"grid-container"};function le(e,t,s,S,C,i){const v=g("MoneyInput"),y=g("ConfirmButton");return u(),f("div",se,[a(j,{onSubmit:_(i.localOnSubmit,["prevent"]),ref:"formRef"},{default:o(()=>[r("div",re,[a(D,{density:"compact",name:"products",items:e.products,"item-title":"descricao","item-value":"id",modelValue:s.currentItem.produtoId,"onUpdate:modelValue":t[0]||(t[0]=p=>s.currentItem.produtoId=p),rules:e.requiredField,variant:"outlined"},{label:o(()=>t[1]||(t[1]=[r("span",null,[n("Produto "),r("span",{style:{color:"red"}},"*")],-1)])),_:1},8,["items","modelValue","rules"]),(u(!0),f(P,null,k(s.currentItem.precos,(p,m)=>(u(),f("div",{key:m},[a(v,{modelValue:s.currentItem.precos[m],"onUpdate:modelValue":I=>s.currentItem.precos[m]=I,style:{width:"120px"},type:"number",label:`Preço ${m+1}`,density:"compact",variant:"outlined",placeholder:`Preço ${m+1}`},null,8,["modelValue","onUpdate:modelValue","label","placeholder"])]))),128))])]),_:1},8,["onSubmit"]),a(b,{class:"justify-end dense pt-6"},{default:o(()=>[a(d,{class:"text-end"},{default:o(()=>[a(F,{location:"top",disabled:i.isFormValid},{activator:o(({props:p})=>[r("span",z(L(p)),[a(y,{color:i.isFormValid?"success":"grey",onConfirm:i.localOnSubmit,loading:e.isSubmitting,disabled:!i.isFormValid||e.isSubmitting},{default:o(()=>t[2]||(t[2]=[n("Salvar")])),_:1},8,["color","onConfirm","loading","disabled"])],16)]),default:o(()=>[t[3]||(t[3]=r("span",null,"Preencha todos os campos obrigatórios (*) para habilitar o botão",-1))]),_:1},8,["disabled"])]),_:1})]),_:1})])}const ie=w(oe,[["render",le],["__scopeId","data-v-a7d5a2db"]]),ne={name:"EditProduto",components:{ConfirmButton:$,MoneyInput:H},props:{onSubmit:Function,currentItem:{type:Object}},data:()=>({isSubmitting:!1,products:[],requiredField:[e=>e!=null&&e!==""||"Obrigatório"]}),computed:{isFormValid(){return!!this.currentItem.produto.descricao}},methods:{parseReal(e){return e=R.parseReal(e),e},async getProducts(){try{const e=await q.get("/public/produtos");console.log(e.data),Array.isArray(e.data)?this.products=e.data:(console.log("A resposta da API não é um Array"),this.products=[])}catch(e){console.log("Error: ",e),this.products=[]}},async localOnSubmit(){try{const e={...this.currentItem};this.onSubmit(e)}catch(e){console.log("Erro: ",e)}}},mounted(){this.getProducts(),this.currentItem&&this.currentItem.precos&&this.currentItem.precos.forEach((e,t)=>{e.valor=this.parseReal(e.valor)})}},de={class:"pa-4 pr-12 pl-12"},ue={class:"grid-container"};function pe(e,t,s,S,C,i){const v=g("MoneyInput"),y=g("ConfirmButton");return u(),f("div",de,[a(j,{onSubmit:_(i.localOnSubmit,["prevent"]),ref:"formRef"},{default:o(()=>[r("div",ue,[a(D,{density:"compact",name:"products",items:e.products,"item-title":"descricao","item-value":"id",modelValue:s.currentItem.produto.descricao,"onUpdate:modelValue":t[0]||(t[0]=p=>s.currentItem.produto.descricao=p),variant:"outlined"},{label:o(()=>t[1]||(t[1]=[r("span",null,[n("Produto "),r("span",{style:{color:"red"}},"*")],-1)])),_:1},8,["items","modelValue"]),(u(!0),f(P,null,k(s.currentItem.precos,(p,m)=>(u(),f("div",{key:m},[a(v,{modelValue:p.valor,"onUpdate:modelValue":I=>p.valor=I,style:{width:"120px"},type:"number",label:`Preço ${m+1}`,density:"compact",variant:"outlined",placeholder:`Preço ${m+1}`},null,8,["modelValue","onUpdate:modelValue","label","placeholder"])]))),128))])]),_:1},8,["onSubmit"]),a(b,{class:"justify-end dense pt-6"},{default:o(()=>[a(d,{class:"text-end"},{default:o(()=>[a(F,{location:"top",disabled:i.isFormValid},{activator:o(({props:p})=>[r("span",z(L(p)),[a(y,{color:i.isFormValid?"success":"grey",onConfirm:i.localOnSubmit,loading:e.isSubmitting,disabled:!i.isFormValid||e.isSubmitting},{default:o(()=>t[2]||(t[2]=[n("Salvar")])),_:1},8,["color","onConfirm","loading","disabled"])],16)]),default:o(()=>[t[3]||(t[3]=r("span",null,"Preencha todos os campos obrigatórios (*) para habilitar o botão",-1))]),_:1},8,["disabled"])]),_:1})]),_:1})])}const ce=w(ne,[["render",pe],["__scopeId","data-v-1801e0c3"]]),me={name:"ProdutorExpand",props:{pesquisaData:Object},data:()=>({productors:[],headers:[{title:"Arquivo",align:"start",sortable:!0,value:"fileName"},{title:"Tipo",align:"start",sortable:!0,value:"fileType"},{title:"Baixar",align:"start",sortable:!0,value:"download"},{title:"Remover",align:"start",sortable:!0,value:"remove"}]}),methods:{formatPrice(e){return e=R.formatReal(e),e},formatDateBr(e){return R.formatDateBr(e)}}},fe={align:"start",class:"pa-2"},ge={align:"start",class:"pa-2"};function ve(e,t,s,S,C,i){return u(),f(P,null,[t[10]||(t[10]=r("h3",{class:"mt-2"},"Detalhes da Pesquisa de Preço",-1)),r("h4",fe,[t[1]||(t[1]=n(" Dados do Produto ")),a(h,null,{default:o(()=>t[0]||(t[0]=[n("mdi-corn")])),_:1})]),a(b,{dense:"",style:{height:"100px"},class:"border-md pa-2 ga-6"},{default:o(()=>[a(d,{cols:"auto",align:"start",class:"h-50"},{default:o(()=>[t[2]||(t[2]=r("h4",null,"ID:",-1)),r("p",null,c(s.pesquisaData.produto.id),1)]),_:1}),a(d,{cols:"auto",align:"start",class:"h-50"},{default:o(()=>[t[3]||(t[3]=r("h4",null,"Descrição:",-1)),r("p",null,c(s.pesquisaData.produto.descricao),1)]),_:1}),a(d,{cols:"1",align:"start",class:"h-50"},{default:o(()=>[t[4]||(t[4]=r("h4",null,"Unidade:",-1)),r("p",null,c(s.pesquisaData.produto.unidade),1)]),_:1}),a(d,{cols:"3",align:"start",class:"h-50"},{default:o(()=>[t[5]||(t[5]=r("h4",null,"Preço Médio:",-1)),r("p",null,c(i.formatPrice(s.pesquisaData.produto.precoMedio)),1)]),_:1})]),_:1}),r("h4",ge,[t[7]||(t[7]=n(" Dados da Pesquisa ")),a(h,null,{default:o(()=>t[6]||(t[6]=[n("mdi-note-search")])),_:1})]),a(b,{dense:"",style:{height:"100px"},class:"border-md pa-2 ga-6 mb-2"},{default:o(()=>[a(d,{cols:"auto",align:"start",class:"h-75"},{default:o(()=>[t[8]||(t[8]=r("h4",null,"ID:",-1)),r("p",null,c(s.pesquisaData.id),1)]),_:1}),(u(!0),f(P,null,k(s.pesquisaData.precos,(v,y)=>(u(),A(d,{cols:"auto",align:"start",class:"h-75",key:y},{default:o(()=>[r("h4",null,"Preço "+c(y+1)+":",1),r("p",null,c(v.valor),1)]),_:2},1024))),128)),a(d,{cols:"auto",align:"start",class:"h-75"},{default:o(()=>[t[9]||(t[9]=r("h4",null,"Data da Pesquisa:",-1)),r("p",null,c(i.formatDateBr(s.pesquisaData.dataPesquisa)),1)]),_:1})]),_:1})],64)}const ye=w(me,[["render",ve]]),he={name:"PesquisaDePreco",components:{NavBar:J,NovaPesquisa:ie,ProdutorExpand:ye,EditPesquisa:ce,BtnComeBack:K},data:()=>({dialog:{create:!1,update:!1},search:"",showFilters:!1,singleExpand:!1,showFilters:!1,products:[],research:[],filtered:[],unidade:[{type:"G",value:"G"},{type:"Kg",value:"Kg"},{type:"T",value:"T"},{type:"L",value:"L"},{type:"Ml",value:"Ml"},{type:"UND",value:"Und"},{type:"Maço",value:"Maço"},{type:"Caixas",value:"Caixas"},{type:"Pacotes",value:"Pacotes"},{type:"Fardos",value:"Fardos"},{type:"Sacos",value:"Sacos"}],headers:[{text:"Editar",align:"center",value:"edit"},{title:"Produto",align:"center",sortable:!0,value:"produto.descricao"},{title:"Unidade",align:"center",sortable:!0,value:"produto.unidade"}],newItem:{precos:[null,null,null]},selectedRow:{},expanded:[],filterActive:!1,filters:{product:{value:null,compareType:"equal",prop:"produto.descricao"},unidade:{value:null,compareType:"equal",prop:"produto.unidade"},data:{value:null,compareType:"equal",prop:"dataPesquisa"}}}),watch:{"currentItem.precos":{handler(e){e.forEach((t,s)=>{t.valor=this.parseReal(t.valor)})},deep:!0}},computed:{filteredResearch(){return this.research.filter(e=>this.filters.product.value?e.produto.descricao===this.filters.product.value:!0).filter(e=>this.filters.unidade.value?e.produto.unidade===this.filters.unidade.value:!0)},dinamycHeaders(){const e=[...this.headers];if(this.research.length>0&&Array.isArray(this.research[0].precos)){const t=this.research[0].precos.length;for(let s=0;s<t;s++)e.push({title:`Preço ${s+1}`,align:"center",value:`precos[${s}].valor`})}return e}},methods:{onExpand(e){this.expanded=e.length>0?[e[e.length-1]]:[]},formatPrice(e){return e=R.formatReal(e),e},applyFilters(){this.filterActive=!0,this.filtered=this.research.filter(e=>Object.keys(this.filters).every(t=>{const s=this.filters[t];return s.value!==null&&s.value!==""&&s.compareType==="equal"?e[s.prop]===s.value:!0}))},clearFilters(){Object.keys(this.filters).forEach(e=>{this.filters[e].value=null}),this.filterActive=!1,this.filtered=[]},async getResearch(){try{const e=await q.get("/public/pesquisas");console.log("Resposta da Api: ",e.data),Array.isArray(e.data)?(this.research=e.data,this.research.forEach(t=>{t.precos.forEach(s=>{s.valor=this.formatPrice(s.valor)})})):(console.log("A resposta da API não é um Array"),this.research=[])}catch(e){console.log("Error: ",e),this.research=[]}},async createProduct(e){const t=O();console.log(e);try{const s=await q.post("/public/pesquisas/pesquisa",e);if(console.log(s.data),s.status!==201)throw new Error(`Erro: ${s.status}`);t.success("Pesquisa cadastrada com sucesso!")}catch(s){console.error("Erro: ",s),t.error("Erro ao cadastrar pesquisa: ",s)}finally{this.dialog.create=!1,this.getResearch()}},async updateProduct(e){console.log(e);const t=O();try{const s=await q.put(`/public/pesquisas/pesquisa/${e.id}`,e);if(console.log(s.data),s.status!==200)throw new Error(`Erro: ${s.status}`);t.success("Pesquisa atualizada com sucesso!")}catch(s){console.error("Erro: ",s),t.error("Erro ao atualizar a pesquisa: ",s)}finally{this.dialog.update=!1,this.getResearch()}},async getProducts(){try{const e=await q.get("/public/produtos");console.log(e.data),Array.isArray(e.data)?this.products=e.data:(console.log("A resposta da API não é um Array"),this.products=[])}catch(e){console.log("Error: ",e),this.products=[]}},onSelectRow(e,t){console.log("Linha selecionada: ",this.selectedRow),t==="update"&&(this.selectedRow=JSON.parse(JSON.stringify({...e})),this.dialog.update=!0)}},mounted(){this.getResearch(),this.getProducts()}},be={colspan:9,style:{"background-color":"#37622a"},class:"text-white"};function Pe(e,t,s,S,C,i){const v=g("NavBar"),y=g("BtnComeBack"),p=g("ProdutorExpand"),m=g("NovaPesquisa"),I=g("EditPesquisa");return u(),f(P,null,[a(v),a(y),t[24]||(t[24]=r("h1",{style:{color:"#57a340","margin-top":"10px",padding:"30px","font-size":"3rem"}},"Pesquisa De Preço",-1)),a(b,{justify:"center",class:"pr-2"},{default:o(()=>[a(d,{cols:"12"},{default:o(()=>[a(G,{items:i.filteredResearch,headers:i.dinamycHeaders,search:e.search,"show-expand":"",expanded:e.expanded,"onUpdate:expanded":[t[5]||(t[5]=l=>e.expanded=l),i.onExpand],"fixed-header":!0,height:"700px"},{top:o(()=>[a(b,{class:"mt-2 mb-8 mx-3"},{default:o(()=>[a(d,{cols:"5"},{default:o(()=>[a(Q,{class:"border rounded",dense:"",outlined:"","hide-details":"",modelValue:e.search,"onUpdate:modelValue":t[0]||(t[0]=l=>e.search=l),label:"Pesquisar","append-inner-icon":"mdi-magnify",clearable:""},null,8,["modelValue"])]),_:1}),a(d,{class:"text-end",cols:"2"},{default:o(()=>[a(W,{location:"top start",bordered:"",overlap:""},{default:o(()=>[a(V,{class:"elevation-0",onClick:t[1]||(t[1]=l=>e.showFilters=!e.showFilters)},{default:o(()=>[e.showFilters?(u(),A(h,{key:1,left:"",size:"25px"},{default:o(()=>t[11]||(t[11]=[n("mdi-filter-off")])),_:1})):(u(),A(h,{key:0,size:"25px",left:""},{default:o(()=>t[10]||(t[10]=[n("mdi-filter")])),_:1})),t[12]||(t[12]=n(" FILTROS "))]),_:1})]),_:1})]),_:1}),a(d,{class:"button-group mr-4",align:"end"},{default:o(()=>[a(F,{location:"top"},{activator:o(({props:l})=>[a(V,T({color:"success",class:"elevation-3 compact-btn ml-3","min-width":"25%",onClick:t[2]||(t[2]=E=>e.dialog.create=!0)},l),{default:o(()=>[a(h,{small:"",class:"compact-icon",left:""},{default:o(()=>t[13]||(t[13]=[n("mdi-plus")])),_:1}),t[14]||(t[14]=r("div",{class:"d-flex flex-column compact-btn-text",style:{"font-size":"0.6rem"}},[r("span",null,"Nova"),n(),r("span",null,"Pesquisa")],-1))]),_:2},1040)]),default:o(()=>[t[15]||(t[15]=r("span",null,"Clique para adicionar uma pesquisa",-1))]),_:1})]),_:1}),a(d,{cols:"12"},{default:o(()=>[a(X,null,{default:o(()=>[Y(a(B,{variant:"outlined",height:"150px"},{default:o(()=>[t[17]||(t[17]=r("h4",{class:"ml-4 mt-4",align:"start"},"Filtrar por",-1)),a(b,{dense:"",class:"py-2 px-4"},{default:o(()=>[a(d,{cols:2},{default:o(()=>[a(D,{density:"compact",variant:"outlined",items:e.products,label:"Produto","item-title":"descricao","item-value":"descricao",modelValue:e.filters.product.value,"onUpdate:modelValue":t[3]||(t[3]=l=>e.filters.product.value=l),outlined:"",dense:""},null,8,["items","modelValue"])]),_:1}),a(d,{cols:4},{default:o(()=>[a(D,{density:"compact",variant:"outlined",items:e.unidade,label:"Unidade","item-title":"type","item-value":"value",modelValue:e.filters.unidade.value,"onUpdate:modelValue":t[4]||(t[4]=l=>e.filters.unidade.value=l)},null,8,["items","modelValue"])]),_:1})]),_:1}),a(ee,null,{default:o(()=>[a(b,{dense:""},{default:o(()=>[a(d,{class:"text-end",height:"200"},{default:o(()=>[a(V,{align:"start",justify:"center",class:"pb-8",color:"error",text:"",elevation:"0",onClick:i.clearFilters},{default:o(()=>t[16]||(t[16]=[n(" Limpar filtros ")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},512),[[Z,e.showFilters]])]),_:1})]),_:1})]),_:1})]),"item.edit":o(({item:l})=>[a(F,{location:"top"},{activator:o(({props:E})=>[a(V,T({icon:""},E,{onClick:U=>i.onSelectRow(l,"update"),class:"elevation-0"}),{default:o(()=>[a(h,{color:"green"},{default:o(()=>t[18]||(t[18]=[n("mdi-pencil")])),_:1})]),_:2},1040,["onClick"])]),default:o(()=>[t[19]||(t[19]=r("span",null,"Clique para editar um Produtor",-1))]),_:2},1024)]),"expanded-row":o(({item:l})=>[r("tr",null,[r("td",be,[n(c(console.log(l))+" ",1),a(p,{pesquisaData:l},null,8,["pesquisaData"])])])]),"item.precos":o(({item:l})=>[n(c(console.log(l.precos))+" ",1),(u(!0),f(P,null,k(l.precos,(E,U)=>(u(),f(P,{key:U},[r("span",null,c(E.valor),1),t[20]||(t[20]=r("span",null,"-",-1))],64))),128))]),_:2},1032,["items","headers","search","expanded","onUpdate:expanded"]),a(N,{modelValue:e.dialog.create,"onUpdate:modelValue":t[7]||(t[7]=l=>e.dialog.create=l)},{default:o(()=>[a(B,{class:"card-form align-self-center",width:"60%"},{default:o(()=>[a(x,{class:"sticky-title title-border"},{default:o(()=>[t[22]||(t[22]=n(" Cadastro de Produto ")),a(M),a(V,{icon:"",class:"btn-close elevation-0",onClick:t[6]||(t[6]=l=>e.dialog.create=!1)},{default:o(()=>[a(h,{prepend:""},{default:o(()=>t[21]||(t[21]=[n(" mdi-close ")])),_:1})]),_:1})]),_:1}),a(m,{currentItem:e.newItem,onSubmit:i.createProduct,dialogAtivo:e.dialog.create},null,8,["currentItem","onSubmit","dialogAtivo"])]),_:1})]),_:1},8,["modelValue"]),a(N,{modelValue:e.dialog.update,"onUpdate:modelValue":t[9]||(t[9]=l=>e.dialog.update=l)},{default:o(()=>[a(B,{class:"card-form align-self-center",width:"60%"},{default:o(()=>[a(x,{class:"sticky-title title-border"},{default:o(()=>[n(" Editar Produtor: "+c(e.selectedRow.id)+" ",1),a(M),a(V,{icon:"",class:"btn-close elevation-0",onClick:t[8]||(t[8]=l=>e.dialog.update=!1)},{default:o(()=>[a(h,{prepend:""},{default:o(()=>t[23]||(t[23]=[n(" mdi-close ")])),_:1})]),_:1})]),_:1}),a(I,{currentItem:e.selectedRow,onSubmit:i.updateProduct},null,8,["currentItem","onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})],64)}const Ce=w(he,[["render",Pe],["__scopeId","data-v-c170df6a"]]);export{Ce as default};
