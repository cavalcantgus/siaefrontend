import{a as q}from"./axios-B7aoVuMY.js";import{N as J}from"./NavBar-14JaM0rc.js";import{C as j}from"./ConfirmButton-Dm3wSqTS.js";import{_ as I,r as v,o as p,c as A,t as f,b as a,w as s,a as r,C as D,d as n,F as P,v as R,l as U,j as z,i as L,g as d,K as F,L as $,M as Q,f as h,H as b,z as c,u as O,s as K,P as G,p as V,O as T,Q as W,D as X,R as Y,e as k,m as Z,S as N,J as M,T as x}from"./index-CT5SwoqP.js";import{U as C}from"./utilsService-D61Juas6.js";const _={name:"MoneyInput",data:()=>({options:{prefix:"R$",decimal:",",thousands:".",precision:"2",masked:!1}})};function ee(e,t,l,w,S,i){const g=v("vuetify-money");return p(),A(g,{options:e.options},null,8,["options"])}const H=I(_,[["render",ee]]),te={name:"NovaPesquisa",components:{ConfirmButton:j,MoneyInput:H},props:{onSubmit:Function,currentItem:{type:Object},dialogAtivo:{type:Boolean,required:!0}},data:()=>({isSubmitting:!1,products:[],requiredField:[e=>e!=null&&e!==""||"Obrigatório"]}),watch:{dialogAtivo(e){e||this.resetState()}},computed:{isFormValid(){return!!(this.currentItem.produtoId&&this.currentItem.quantidade)}},methods:{resetState(){Object.keys(this.currentItem).forEach(e=>{this.currentItem[e]=null})},async getProducts(){try{const e=await q.get("/public/produtos");console.log(e.data),Array.isArray(e.data)?this.products=e.data:(console.log("A resposta da API não é um Array"),this.products=[])}catch(e){console.log("Error: ",e),this.products=[]}},async localOnSubmit(){try{this.currentItem.dataPesquisa=new Date;const e={...this.currentItem};console.log(e),this.onSubmit(e)}catch(e){console.log("Erro: ",e)}}},mounted(){this.getProducts()}},ae={class:"pa-4 pr-12 pl-12"},se={class:"grid-container"};function le(e,t,l,w,S,i){const g=v("MoneyInput"),y=v("ConfirmButton");return p(),f("div",ae,[a(L,{onSubmit:z(i.localOnSubmit,["prevent"]),ref:"formRef"},{default:s(()=>[r("div",se,[a(D,{density:"compact",name:"products",items:e.products,"item-title":"descricao","item-value":"id",modelValue:l.currentItem.produtoId,"onUpdate:modelValue":t[0]||(t[0]=u=>l.currentItem.produtoId=u),rules:e.requiredField,variant:"outlined"},{label:s(()=>t[2]||(t[2]=[r("span",null,[n("Produto "),r("span",{style:{color:"red"}},"*")],-1)])),_:1},8,["items","modelValue","rules"]),(p(!0),f(P,null,R(l.currentItem.precos,(u,m)=>(p(),f("div",{key:m},[a(g,{modelValue:l.currentItem.precos[m],"onUpdate:modelValue":o=>l.currentItem.precos[m]=o,style:{width:"120px"},type:"number",label:`Preço ${m+1}`,density:"compact",variant:"outlined",placeholder:`Preço ${m+1}`},null,8,["modelValue","onUpdate:modelValue","label","placeholder"])]))),128)),a(U,{modelValue:l.currentItem.quantidade,"onUpdate:modelValue":t[1]||(t[1]=u=>l.currentItem.quantidade=u),type:"number",rules:e.requiredField,variant:"outlined",density:"compact"},{label:s(()=>t[3]||(t[3]=[r("span",null,[n("Quantidade "),r("span",{style:{color:"red"}},"*")],-1)])),_:1},8,["modelValue","rules"])])]),_:1},8,["onSubmit"]),a(h,{class:"justify-end dense pt-6"},{default:s(()=>[a(d,{class:"text-end"},{default:s(()=>[a(F,{location:"top",disabled:i.isFormValid},{activator:s(({props:u})=>[r("span",$(Q(u)),[a(y,{color:i.isFormValid?"success":"grey",onConfirm:i.localOnSubmit,loading:e.isSubmitting,disabled:!i.isFormValid||e.isSubmitting},{default:s(()=>t[4]||(t[4]=[n("Salvar")])),_:1},8,["color","onConfirm","loading","disabled"])],16)]),default:s(()=>[t[5]||(t[5]=r("span",null,"Preencha todos os campos obrigatórios (*) para habilitar o botão",-1))]),_:1},8,["disabled"])]),_:1})]),_:1})])}const re=I(te,[["render",le],["__scopeId","data-v-1732633b"]]),oe={name:"EditProduto",components:{ConfirmButton:j,MoneyInput:H},props:{onSubmit:Function,currentItem:{type:Object}},data:()=>({isSubmitting:!1,products:[],requiredField:[e=>e!=null&&e!==""||"Obrigatório"]}),computed:{isFormValid(){return!!(this.currentItem.produto.descricao&&this.currentItem.quantidade)}},methods:{parseReal(e){return e=C.parseReal(e),e},async getProducts(){try{const e=await q.get("/public/produtos");console.log(e.data),Array.isArray(e.data)?this.products=e.data:(console.log("A resposta da API não é um Array"),this.products=[])}catch(e){console.log("Error: ",e),this.products=[]}},async localOnSubmit(){try{const e={...this.currentItem};this.onSubmit(e)}catch(e){console.log("Erro: ",e)}}},mounted(){this.getProducts(),this.currentItem&&this.currentItem.precos&&this.currentItem.precos.forEach((e,t)=>{e.valor=this.parseReal(e.valor)})}},ie={class:"pa-4 pr-12 pl-12"},ne={class:"grid-container"};function de(e,t,l,w,S,i){const g=v("MoneyInput"),y=v("ConfirmButton");return p(),f("div",ie,[a(L,{onSubmit:z(i.localOnSubmit,["prevent"]),ref:"formRef"},{default:s(()=>[r("div",ne,[a(D,{density:"compact",name:"products",items:e.products,"item-title":"descricao","item-value":"id",modelValue:l.currentItem.produto.descricao,"onUpdate:modelValue":t[0]||(t[0]=u=>l.currentItem.produto.descricao=u),variant:"outlined"},{label:s(()=>t[2]||(t[2]=[r("span",null,[n("Produto "),r("span",{style:{color:"red"}},"*")],-1)])),_:1},8,["items","modelValue"]),(p(!0),f(P,null,R(l.currentItem.precos,(u,m)=>(p(),f("div",{key:m},[a(g,{modelValue:u.valor,"onUpdate:modelValue":o=>u.valor=o,style:{width:"120px"},type:"number",label:`Preço ${m+1}`,density:"compact",variant:"outlined",placeholder:`Preço ${m+1}`},null,8,["modelValue","onUpdate:modelValue","label","placeholder"])]))),128)),a(U,{modelValue:l.currentItem.quantidade,"onUpdate:modelValue":t[1]||(t[1]=u=>l.currentItem.quantidade=u),type:"number",rules:e.requiredField,variant:"outlined",density:"compact"},{label:s(()=>t[3]||(t[3]=[r("span",null,[n("Quantidade "),r("span",{style:{color:"red"}},"*")],-1)])),_:1},8,["modelValue","rules"])])]),_:1},8,["onSubmit"]),a(h,{class:"justify-end dense pt-6"},{default:s(()=>[a(d,{class:"text-end"},{default:s(()=>[a(F,{location:"top",disabled:i.isFormValid},{activator:s(({props:u})=>[r("span",$(Q(u)),[a(y,{color:i.isFormValid?"success":"grey",onConfirm:i.localOnSubmit,loading:e.isSubmitting,disabled:!i.isFormValid||e.isSubmitting},{default:s(()=>t[4]||(t[4]=[n("Salvar")])),_:1},8,["color","onConfirm","loading","disabled"])],16)]),default:s(()=>[t[5]||(t[5]=r("span",null,"Preencha todos os campos obrigatórios (*) para habilitar o botão",-1))]),_:1},8,["disabled"])]),_:1})]),_:1})])}const ue=I(oe,[["render",de],["__scopeId","data-v-6d220f55"]]),pe={name:"ProdutorExpand",props:{pesquisaData:Object},data:()=>({productors:[],headers:[{title:"Arquivo",align:"start",sortable:!0,value:"fileName"},{title:"Tipo",align:"start",sortable:!0,value:"fileType"},{title:"Baixar",align:"start",sortable:!0,value:"download"},{title:"Remover",align:"start",sortable:!0,value:"remove"}]}),methods:{formatPrice(e){return e=C.formatReal(e),e},formatDateBr(e){return C.formatDateBr(e)}}},ce={align:"start",class:"pa-2"},me={align:"start",class:"pa-2"};function fe(e,t,l,w,S,i){return p(),f(P,null,[t[12]||(t[12]=r("h3",{class:"mt-2"},"Detalhes da Pesquisa de Preço",-1)),r("h4",ce,[t[1]||(t[1]=n(" Dados do Produto ")),a(b,null,{default:s(()=>t[0]||(t[0]=[n("mdi-corn")])),_:1})]),a(h,{dense:"",style:{height:"100px"},class:"border-md pa-2 ga-6"},{default:s(()=>[a(d,{cols:"auto",align:"start",class:"h-50"},{default:s(()=>[t[2]||(t[2]=r("h4",null,"ID:",-1)),r("p",null,c(l.pesquisaData.produto.id),1)]),_:1}),a(d,{cols:"auto",align:"start",class:"h-50"},{default:s(()=>[t[3]||(t[3]=r("h4",null,"Descrição:",-1)),r("p",null,c(l.pesquisaData.produto.descricao),1)]),_:1}),a(d,{cols:"1",align:"start",class:"h-50"},{default:s(()=>[t[4]||(t[4]=r("h4",null,"Unidade:",-1)),r("p",null,c(l.pesquisaData.produto.unidade),1)]),_:1}),a(d,{cols:"3",align:"start",class:"h-50"},{default:s(()=>[t[5]||(t[5]=r("h4",null,"Preço Médio:",-1)),r("p",null,c(i.formatPrice(l.pesquisaData.produto.precoMedio)),1)]),_:1})]),_:1}),r("h4",me,[t[7]||(t[7]=n(" Dados da Pesquisa ")),a(b,null,{default:s(()=>t[6]||(t[6]=[n("mdi-note-search")])),_:1})]),a(h,{dense:"",style:{height:"100px"},class:"border-md pa-2 ga-6 mb-2"},{default:s(()=>[a(d,{cols:"auto",align:"start",class:"h-75"},{default:s(()=>[t[8]||(t[8]=r("h4",null,"ID:",-1)),r("p",null,c(l.pesquisaData.id),1)]),_:1}),a(d,{cols:"auto",align:"start",class:"h-75"},{default:s(()=>[t[9]||(t[9]=r("h4",null,"Quantidade:",-1)),r("p",null,c(l.pesquisaData.quantidade),1)]),_:1}),(p(!0),f(P,null,R(l.pesquisaData.precos,(g,y)=>(p(),A(d,{cols:"auto",align:"start",class:"h-75",key:y},{default:s(()=>[r("h4",null,"Preço "+c(y+1)+":",1),r("p",null,c(g.valor),1)]),_:2},1024))),128)),a(d,{cols:"auto",align:"start",class:"h-75"},{default:s(()=>[t[10]||(t[10]=r("h4",null,"Data da Pesquisa:",-1)),r("p",null,c(i.formatDateBr(l.pesquisaData.dataPesquisa)),1)]),_:1}),a(d,{cols:"auto",align:"start",class:"h-75"},{default:s(()=>[t[11]||(t[11]=r("h4",null,"Total",-1)),r("p",null,c(i.formatPrice(l.pesquisaData.total)),1)]),_:1})]),_:1})],64)}const ge=I(pe,[["render",fe]]),ve={name:"PesquisaDePreco",components:{NavBar:J,NovaPesquisa:re,ProdutorExpand:ge,EditPesquisa:ue},data:()=>({dialog:{create:!1,update:!1},search:"",showFilters:!1,singleExpand:!1,showFilters:!1,products:[],research:[],filtered:[],unidade:[{type:"G",value:"G"},{type:"Kg",value:"Kg"},{type:"T",value:"T"},{type:"L",value:"L"},{type:"Ml",value:"Ml"},{type:"UND",value:"Und"},{type:"Maço",value:"Maço"},{type:"Caixas",value:"Caixas"},{type:"Pacotes",value:"Pacotes"},{type:"Fardos",value:"Fardos"},{type:"Sacos",value:"Sacos"}],headers:[{text:"Editar",align:"center",value:"edit"},{title:"Produto",align:"center",sortable:!0,value:"produto.descricao"},{title:"Unidade",align:"center",sortable:!0,value:"produto.unidade"},{title:"Quantidade",align:"center",sortable:!0,value:"quantidade"}],newItem:{precos:[null,null,null]},selectedRow:{},expanded:[],filterActive:!1,filters:{product:{value:null,compareType:"equal",prop:"produto.descricao"},unidade:{value:null,compareType:"equal",prop:"produto.unidade"},data:{value:null,compareType:"equal",prop:"dataPesquisa"}}}),watch:{"currentItem.precos":{handler(e){e.forEach((t,l)=>{t.valor=this.parseReal(t.valor)})},deep:!0}},computed:{filteredResearch(){return this.research.filter(e=>this.filters.product.value?e.produto.descricao===this.filters.product.value:!0).filter(e=>this.filters.unidade.value?e.produto.unidade===this.filters.unidade.value:!0)},dinamycHeaders(){const e=[...this.headers];if(this.research.length>0&&Array.isArray(this.research[0].precos)){const t=this.research[0].precos.length;for(let l=0;l<t;l++)e.push({title:`Preço ${l+1}`,align:"center",value:`precos[${l}].valor`})}return e}},methods:{onExpand(e){this.expanded=e.length>0?[e[e.length-1]]:[]},formatPrice(e){return e=C.formatReal(e),e},applyFilters(){this.filterActive=!0,this.filtered=this.research.filter(e=>Object.keys(this.filters).every(t=>{const l=this.filters[t];return l.value!==null&&l.value!==""&&l.compareType==="equal"?e[l.prop]===l.value:!0}))},clearFilters(){Object.keys(this.filters).forEach(e=>{this.filters[e].value=null}),this.filterActive=!1,this.filtered=[]},async getResearch(){try{const e=await q.get("/public/pesquisas");console.log("Resposta da Api: ",e.data),Array.isArray(e.data)?(this.research=e.data,this.research.forEach(t=>{t.precos.forEach(l=>{l.valor=this.formatPrice(l.valor)})})):(console.log("A resposta da API não é um Array"),this.research=[])}catch(e){console.log("Error: ",e),this.research=[]}},async createProduct(e){const t=O();console.log(e);try{const l=await q.post("/public/pesquisas/pesquisa",e);if(console.log(l.data),l.status!==201)throw new Error(`Erro: ${l.status}`);t.success("Pesquisa cadastrada com sucesso!")}catch(l){console.error("Erro: ",l),t.error("Erro ao cadastrar pesquisa: ",l)}finally{this.dialog.create=!1,this.getResearch()}},async updateProduct(e){console.log(e);const t=O();try{const l=await q.put(`/public/pesquisas/pesquisa/${e.id}`,e);if(console.log(l.data),l.status!==200)throw new Error(`Erro: ${l.status}`);t.success("Pesquisa atualizada com sucesso!")}catch(l){console.error("Erro: ",l),t.error("Erro ao atualizar a pesquisa: ",l)}finally{this.dialog.update=!1,this.getResearch()}},async getProducts(){try{const e=await q.get("/public/produtos");console.log(e.data),Array.isArray(e.data)?this.products=e.data:(console.log("A resposta da API não é um Array"),this.products=[])}catch(e){console.log("Error: ",e),this.products=[]}},onSelectRow(e,t){console.log("Linha selecionada: ",this.selectedRow),t==="update"&&(this.selectedRow=JSON.parse(JSON.stringify({...e})),this.dialog.update=!0)}},mounted(){this.getResearch(),this.getProducts()}},ye={colspan:9,style:{"background-color":"#37622a"},class:"text-white"};function be(e,t,l,w,S,i){const g=v("NavBar"),y=v("ProdutorExpand"),u=v("NovaPesquisa"),m=v("EditPesquisa");return p(),f(P,null,[a(g),t[24]||(t[24]=r("h1",{style:{color:"#57a340","margin-top":"10px",padding:"30px","font-size":"3rem"}},"Pesquisa De Preço",-1)),a(h,{justify:"center",class:"pr-2"},{default:s(()=>[a(d,{cols:"12"},{default:s(()=>[a(K,{items:i.filteredResearch,headers:i.dinamycHeaders,search:e.search,"show-expand":"",expanded:e.expanded,"onUpdate:expanded":[t[5]||(t[5]=o=>e.expanded=o),i.onExpand],"fixed-header":!0,height:"700px"},{top:s(()=>[a(h,{class:"mt-2 mb-8 mx-3"},{default:s(()=>[a(d,{cols:"5"},{default:s(()=>[a(U,{class:"border rounded",dense:"",outlined:"","hide-details":"",modelValue:e.search,"onUpdate:modelValue":t[0]||(t[0]=o=>e.search=o),label:"Pesquisar","append-inner-icon":"mdi-magnify",clearable:""},null,8,["modelValue"])]),_:1}),a(d,{class:"text-end",cols:"2"},{default:s(()=>[a(G,{location:"top start",bordered:"",overlap:""},{default:s(()=>[a(V,{class:"elevation-0",onClick:t[1]||(t[1]=o=>e.showFilters=!e.showFilters)},{default:s(()=>[e.showFilters?(p(),A(b,{key:1,left:"",size:"25px"},{default:s(()=>t[11]||(t[11]=[n("mdi-filter-off")])),_:1})):(p(),A(b,{key:0,size:"25px",left:""},{default:s(()=>t[10]||(t[10]=[n("mdi-filter")])),_:1})),t[12]||(t[12]=n(" FILTROS "))]),_:1})]),_:1})]),_:1}),a(d,{class:"button-group mr-4",align:"end"},{default:s(()=>[a(F,{location:"top"},{activator:s(({props:o})=>[a(V,T({color:"success",class:"elevation-3 compact-btn ml-3","min-width":"25%",onClick:t[2]||(t[2]=E=>e.dialog.create=!0)},o),{default:s(()=>[a(b,{small:"",class:"compact-icon",left:""},{default:s(()=>t[13]||(t[13]=[n("mdi-plus")])),_:1}),t[14]||(t[14]=r("div",{class:"d-flex flex-column compact-btn-text",style:{"font-size":"0.6rem"}},[r("span",null,"Nova"),n(),r("span",null,"Pesquisa")],-1))]),_:2},1040)]),default:s(()=>[t[15]||(t[15]=r("span",null,"Clique para adicionar uma pesquisa",-1))]),_:1})]),_:1}),a(d,{cols:"12"},{default:s(()=>[a(W,null,{default:s(()=>[X(a(k,{variant:"outlined",height:"150px"},{default:s(()=>[t[17]||(t[17]=r("h4",{class:"ml-4 mt-4",align:"start"},"Filtrar por",-1)),a(h,{dense:"",class:"py-2 px-4"},{default:s(()=>[a(d,{cols:2},{default:s(()=>[a(D,{density:"compact",variant:"outlined",items:e.products,label:"Produto","item-title":"descricao","item-value":"descricao",modelValue:e.filters.product.value,"onUpdate:modelValue":t[3]||(t[3]=o=>e.filters.product.value=o),outlined:"",dense:""},null,8,["items","modelValue"])]),_:1}),a(d,{cols:4},{default:s(()=>[a(D,{density:"compact",variant:"outlined",items:e.unidade,label:"Unidade","item-title":"type","item-value":"value",modelValue:e.filters.unidade.value,"onUpdate:modelValue":t[4]||(t[4]=o=>e.filters.unidade.value=o)},null,8,["items","modelValue"])]),_:1})]),_:1}),a(Z,null,{default:s(()=>[a(h,{dense:""},{default:s(()=>[a(d,{class:"text-end",height:"200"},{default:s(()=>[a(V,{align:"start",justify:"center",class:"pb-8",color:"error",text:"",elevation:"0",onClick:i.clearFilters},{default:s(()=>t[16]||(t[16]=[n(" Limpar filtros ")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},512),[[Y,e.showFilters]])]),_:1})]),_:1})]),_:1})]),"item.edit":s(({item:o})=>[a(F,{location:"top"},{activator:s(({props:E})=>[a(V,T({icon:""},E,{onClick:B=>i.onSelectRow(o,"update"),class:"elevation-0"}),{default:s(()=>[a(b,{color:"green"},{default:s(()=>t[18]||(t[18]=[n("mdi-pencil")])),_:1})]),_:2},1040,["onClick"])]),default:s(()=>[t[19]||(t[19]=r("span",null,"Clique para editar um Produtor",-1))]),_:2},1024)]),"expanded-row":s(({item:o})=>[r("tr",null,[r("td",ye,[n(c(console.log(o))+" ",1),a(y,{pesquisaData:o},null,8,["pesquisaData"])])])]),"item.precos":s(({item:o})=>[n(c(console.log(o.precos))+" ",1),(p(!0),f(P,null,R(o.precos,(E,B)=>(p(),f(P,{key:B},[r("span",null,c(E.valor),1),t[20]||(t[20]=r("span",null,"-",-1))],64))),128))]),_:2},1032,["items","headers","search","expanded","onUpdate:expanded"]),a(N,{modelValue:e.dialog.create,"onUpdate:modelValue":t[7]||(t[7]=o=>e.dialog.create=o)},{default:s(()=>[a(k,{class:"card-form align-self-center",width:"60%"},{default:s(()=>[a(M,{class:"sticky-title title-border"},{default:s(()=>[t[22]||(t[22]=n(" Cadastro de Produto ")),a(x),a(V,{icon:"",class:"btn-close elevation-0",onClick:t[6]||(t[6]=o=>e.dialog.create=!1)},{default:s(()=>[a(b,{prepend:""},{default:s(()=>t[21]||(t[21]=[n(" mdi-close ")])),_:1})]),_:1})]),_:1}),a(u,{currentItem:e.newItem,onSubmit:i.createProduct,dialogAtivo:e.dialog.create},null,8,["currentItem","onSubmit","dialogAtivo"])]),_:1})]),_:1},8,["modelValue"]),a(N,{modelValue:e.dialog.update,"onUpdate:modelValue":t[9]||(t[9]=o=>e.dialog.update=o)},{default:s(()=>[a(k,{class:"card-form align-self-center",width:"60%"},{default:s(()=>[a(M,{class:"sticky-title title-border"},{default:s(()=>[n(" Editar Produtor: "+c(e.selectedRow.id)+" ",1),a(x),a(V,{icon:"",class:"btn-close elevation-0",onClick:t[8]||(t[8]=o=>e.dialog.update=!1)},{default:s(()=>[a(b,{prepend:""},{default:s(()=>t[23]||(t[23]=[n(" mdi-close ")])),_:1})]),_:1})]),_:1}),a(m,{currentItem:e.selectedRow,onSubmit:i.updateProduct},null,8,["currentItem","onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})],64)}const we=I(ve,[["render",be],["__scopeId","data-v-3505e23f"]]);export{we as default};
