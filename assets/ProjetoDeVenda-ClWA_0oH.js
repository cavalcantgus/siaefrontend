import{a as v}from"./axios-BT81ka_Q.js";import{N as K}from"./NavBar-B8k2jPFv.js";import{C as B,U as k}from"./utilsService-BWVlYyOY.js";import{_ as R,r as w,o as y,t as P,b as a,w as o,a as r,f as b,g as i,C as M,d as u,p as I,H as h,F as U,v as z,l as V,c as F,A as C,z as n,X as x,K as E,O as A,j as G,i as W,L,M as Y,u as S,N as X,P as Z,W as $,T as N,e as Q,J as T,U as O}from"./index-BfibuI2h.js";import{B as _}from"./BtnComeBack-BEeqsQgG.js";const tt={name:"NovoProduto",components:{ConfirmButton:B},props:{onSubmit:Function,currentItem:{type:Object},dialogAtivo:{type:Boolean,required:!0}},data:()=>({passedOfLimit:!1,totalGeral:0,unidade:"",precoMedio:"",isSubmitting:!1,isDuplicate:!1,products:[],producers:[],items:{itemsProducts:[{produtoId:null,unidade:null,precoMedio:null}],itemsQuantity:[],itemsInicioEntrega:[],itemsFimEntrega:[]},options:{decimal:",",thousands:".",precision:"2",masked:!1},quantityWarnings:[],quantityValid:!0,requiredField:[e=>e!=null&&e!==""||"Obrigatório"]}),watch:{dialogAtivo(e){e||this.resetState()},"items.itemsProducts":{handler(e){this.validateQuantity(),this.updateTotalGeral(),e.forEach((t,l)=>{if(t&&t.produtoId){t&&t.produtoId&&(this.isDuplicate=e.some((m,d)=>d!==l&&m.produtoId===t.produtoId));const s=this.products.find(m=>m.id===t.produtoId);console.log(t.produtoId),s&&(this.items.itemsProducts[l].unidade=s.produto.unidade,this.items.itemsProducts[l].precoMedio=s.produto.precoMedio)}})},deep:!0},"items.itemsQuantity":{handler(){this.validateQuantity(),this.updateTotalGeral()},deep:!0}},computed:{isFormValid(){const e=this.items.itemsInicioEntrega.every(s=>s&&s.trim()!==""&&!isNaN(Date.parse(s))),t=this.items.itemsFimEntrega.every(s=>s&&s.trim()!==""&&!isNaN(Date.parse(s))),l=this.items.itemsProducts.every(s=>s.produtoId&&s.unidade&&s.precoMedio);return!!(this.currentItem.produtorId&&l&&e&&t&&this.quantityValid&&!this.isDuplicate&&!this.passedOfLimit)}},methods:{validateQuantity(){this.quantityWarnings=this.items.itemsProducts.map((e,t)=>{const l=e.produtoId,s=this.items.itemsQuantity[t]||0;if(!l)return null;const m=this.products.find(d=>d.id===l);return m&&s>m.quantidade?(this.quantityValid=!1,`Limite permitido para ${m.produto.descricao} (${m.quantidade}).`):(this.quantityValid=!0,null)})},formatPrice(e){return e=k.formatReal(e),e},updateTotalGeral(){this.totalGeral=this.items.itemsProducts.reduce((e,t,l)=>{const s=this.items.itemsQuantity[l]||0,m=parseFloat(t.precoMedio)||0;return e+m*s},0).toFixed(2),this.passedOfLimit=this.totalGeral>4e4},addItem(){this.items.itemsProducts.push({produtoId:null,unidade:null,precoMedio:null}),this.items.itemsQuantity.push(null),this.items.itemsInicioEntrega.push(null),this.items.itemsFimEntrega.push(null)},removeItem(e){this.items.itemsProducts.splice(e,1),this.items.itemsQuantity.splice(e,1),this.items.itemsInicioEntrega.splice(e,1),this.items.itemsFimEntrega.splice(e,1)},resetState(){Object.keys(this.currentItem).forEach(e=>{this.currentItem[e]=null})},async localOnSubmit(){try{const e={...this.currentItem,pesquisasId:this.items.itemsProducts.map(t=>t.produtoId),inicioEntrega:this.items.itemsInicioEntrega,fimEntrega:this.items.itemsFimEntrega,quantidade:this.items.itemsQuantity};console.log(e),this.onSubmit(e)}catch(e){console.log("Erro: ",e)}},async getResearchs(){try{const e=await v.get("/public/pesquisas");console.log(e.data),Array.isArray(e.data)?(this.products=e.data,console.log(e.data)):(console.log("A resposta da API não é um Array"),this.products=[])}catch(e){console.log("Error: ",e),this.products=[]}},async getProductors(){try{const e=await v.get("/public/produtores");console.log(e.data),this.producers=e.data}catch(e){console.log("Error: ",e),this.producers=[]}}},mounted(){this.getResearchs(),this.getProductors()}},et={class:"pa-3 pr-12 pl-12"},ot={class:"grid-container"},at={class:"mt-3"},lt={class:"mt-3 ml-3 mr-3"},rt={key:2,class:"text-start text-error ml-3",style:{"font-size":"0.8rem","font-weight":"bold",width:"100%","margin-top":"-25px","margin-bottom":"20px"}},st={key:0,style:{color:"red","font-size":"0.8rem","font-weight":"bold",width:"100%","margin-top":"-25px","margin-bottom":"20px"}};function dt(e,t,l,s,m,d){const j=w("vuetify-money"),D=w("ConfirmButton");return y(),P("div",et,[a(W,{onSubmit:G(d.localOnSubmit,["prevent"]),ref:"formRef"},{default:o(()=>[r("div",ot,[a(b,{class:"ml-1 w-100"},{default:o(()=>[a(i,{cols:"12"},{default:o(()=>[a(M,{density:"compact",name:"producer",items:e.producers,"item-title":"nome","item-value":"id",modelValue:l.currentItem.produtorId,"onUpdate:modelValue":t[0]||(t[0]=p=>l.currentItem.produtorId=p),variant:"outlined",rules:e.requiredField,clearable:""},{label:o(()=>t[2]||(t[2]=[r("span",null,[u("Produtor "),r("span",{style:{color:"red"}},"*")],-1)])),_:1},8,["items","modelValue","rules"])]),_:1})]),_:1}),a(b,{class:"w-100",style:{"margin-top":"-50px","margin-left":"-8px"}},{default:o(()=>[a(i,{cols:"12"},{default:o(()=>[a(I,{size:"30px",icon:"",style:{"margin-left":"-26px","margin-bottom":"-85px"},color:"primary",onClick:d.addItem},{default:o(()=>[a(h,{left:"",size:"20px"},{default:o(()=>t[3]||(t[3]=[u("mdi-plus")])),_:1})]),_:1},8,["onClick"]),(y(!0),P(U,null,z(e.items.itemsProducts,(p,c)=>(y(),P("div",{key:c,class:"grid-second-container"},[a(i,{cols:"3"},{default:o(()=>[a(M,{color:e.isDuplicate?"error":"",density:"compact",name:"product",items:e.products,"item-title":"produto.descricao","item-value":"id",modelValue:e.items.itemsProducts[c].produtoId,"onUpdate:modelValue":f=>e.items.itemsProducts[c].produtoId=f,variant:"outlined",rules:e.requiredField,clearable:""},{label:o(()=>t[4]||(t[4]=[r("span",null,[u("Produto "),r("span",{style:{color:"red"}},"*")],-1)])),_:2},1032,["color","items","modelValue","onUpdate:modelValue","rules"])]),_:2},1024),a(i,{cols:"1",style:{"margin-left":"-9px"}},{default:o(()=>[a(V,{density:"compact",name:"unidade",label:"Unidade",modelValue:e.items.itemsProducts[c].unidade,"onUpdate:modelValue":f=>e.items.itemsProducts[c].unidade=f,variant:"outlined",disabled:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(i,{cols:"2",lg:"1",style:{"margin-left":"-9px"}},{default:o(()=>[a(V,{density:"compact",name:"precoMedio",label:"Preço Médio",modelValue:e.items.itemsProducts[c].precoMedio,"onUpdate:modelValue":f=>e.items.itemsProducts[c].precoMedio=f,variant:"outlined",disabled:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(i,{cols:"1",lg:"2",style:{"margin-left":"-9px"}},{default:o(()=>[a(j,{density:"compact",name:"quantidade",label:"Quantidade",options:e.options,modelValue:e.items.itemsQuantity[c],"onUpdate:modelValue":f=>e.items.itemsQuantity[c]=f,variant:"outlined",disabled:e.isDuplicate},null,8,["options","modelValue","onUpdate:modelValue","disabled"])]),_:2},1024),r("div",at,[a(V,{density:"compact",name:"inicioEntrega",label:"De",type:"date",modelValue:e.items.itemsInicioEntrega[c],"onUpdate:modelValue":f=>e.items.itemsInicioEntrega[c]=f,variant:"outlined",rules:e.requiredField},null,8,["modelValue","onUpdate:modelValue","rules"])]),r("div",lt,[a(V,{density:"compact",name:"fimEntrega",label:"Até",type:"date",modelValue:e.items.itemsFimEntrega[c],"onUpdate:modelValue":f=>e.items.itemsFimEntrega[c]=f,variant:"outlined",rules:e.requiredField,"hide-details":!1},null,8,["modelValue","onUpdate:modelValue","rules"])]),e.items.itemsProducts.length>1?(y(),F(I,{key:0,size:"30px",icon:"",color:"error",style:{"margin-top":"15px"},onClick:f=>d.removeItem(c)},{default:o(()=>[a(h,{size:"20px"},{default:o(()=>t[5]||(t[5]=[u("mdi-delete")])),_:1})]),_:2},1032,["onClick"])):C("",!0),e.quantityWarnings[c]?(y(),F(x,{key:1,"max-width":"170px",color:"error",class:"mt-2 mb-6 ml-4",density:"compact",style:{"font-size":"0.7rem",height:"80px","font-weight":"bold"}},{default:o(()=>[u(n(e.quantityWarnings[c]),1)]),_:2},1024)):C("",!0),e.isDuplicate?(y(),P("span",rt,n("Itens duplicados. Por favor, remova-os, ou escolha outro."))):C("",!0)]))),128))]),_:1})]),_:1}),a(b,{class:"w-100",style:{"margin-top":"15px","margin-left":"3px"}},{default:o(()=>[a(i,{cols:"4"},{default:o(()=>[a(E,{location:"end"},{activator:o(({props:p})=>[a(V,A(p,{"max-width":"170px",density:"compact",name:"dataProjeto",label:"Data do Projeto",type:"date",modelValue:l.currentItem.dataProjeto,"onUpdate:modelValue":t[1]||(t[1]=c=>l.currentItem.dataProjeto=c),variant:"outlined",rules:e.requiredField}),null,16,["modelValue","rules"])]),default:o(()=>[t[6]||(t[6]=r("span",null,"Obs: Utilizar a data de realização da Chamada Pública",-1))]),_:1})]),_:1}),a(i,{align:"end",class:"align-self-center"},{default:o(()=>[t[7]||(t[7]=r("h4",null,"Total",-1)),r("span",null,n(d.formatPrice(e.totalGeral)),1),t[8]||(t[8]=r("br",null,null,-1)),e.passedOfLimit?(y(),P("span",st,n("Limite máximo atingido. Por favor, reduza a quantidade"))):C("",!0)]),_:1})]),_:1})])]),_:1},8,["onSubmit"]),a(b,{class:"justify-end dense pt-6"},{default:o(()=>[a(i,{class:"text-end"},{default:o(()=>[a(E,{location:"top",disabled:d.isFormValid},{activator:o(({props:p})=>[r("span",L(Y(p)),[a(D,{color:d.isFormValid?"success":"grey",onConfirm:d.localOnSubmit,loading:e.isSubmitting,disabled:!d.isFormValid||e.isSubmitting},{default:o(()=>t[9]||(t[9]=[u("Salvar")])),_:1},8,["color","onConfirm","loading","disabled"])],16)]),default:o(()=>[t[10]||(t[10]=r("span",null,"Preencha todos os campos obrigatórios (*) para habilitar o botão",-1))]),_:1},8,["disabled"])]),_:1})]),_:1})])}const it=R(tt,[["render",dt],["__scopeId","data-v-4a025062"]]),nt={name:"NovoProduto",components:{ConfirmButton:B},props:{onSubmit:Function,currentItem:{type:Object},dialogAtivo:{type:Boolean,required:!0}},data:()=>({totalGeral:0,unidade:"",precoMedio:"",isSubmitting:!1,isDuplicate:!1,researchs:[],products:[],producers:[],projects:[],items:{itemsProducts:[{produtoId:null,unidade:null,precoMedio:null}],itemsQuantity:[]},options:{decimal:",",thousands:".",precision:"2",masked:!1},quantityWarnings:[],quantityValid:!0,requiredField:[e=>e!=null&&e!==""||"Obrigatório"]}),watch:{dialogAtivo(e){e||this.resetState()},"currentItem.projetoProdutos":{handler(e){this.validateQuantity(),e.forEach((t,l)=>{if(t&&t.produto){const s=this.products.find(m=>m.id===t.produto.id);s&&(t.produto.unidade=s.unidade,t.produto.precoMedio=s.precoMedio)}}),this.updateTotalGeral(),this.isDuplicate=e.some((t,l)=>e.some((s,m)=>l!==m&&t.produto&&s.produto&&t.produto.id===s.produto.id))},deep:!0}},computed:{isFormValid(){const e=this.currentItem.projetoProdutos.every(t=>t.produto);return!!(this.currentItem.produtor&&e&&this.quantityValid&&!this.isDuplicate)}},methods:{validateQuantity(){console.log("Método chamado"),this.quantityWarnings=this.currentItem.projetoProdutos.map(e=>{const t=e.produto.id;if(!t)return null;const l=e.quantidade||0,s=this.researchs.find(d=>d.produto.id===t),m=this.projects.find(d=>d.produto.id===t);if(console.log("Produto:",t,"Quantidade Solicitada:",l),m){const d=this.sumQuantity(t)+s.quantidade;if(console.log("Quantidade Restante:",d),s&&l>d)return`A quantidade inserida excede o limite permitido para ${s.produto.descricao} (${d}).`}else if(s&&l>s.quantidade)return`A quantidade inserida excede o limite permitido para ${s.produto.descricao} (${s.quantidade}).`;return null}),this.quantityValid=this.quantityWarnings.every(e=>e===null)},sumQuantity(e){return this.projects.filter(t=>t.produto.id===e).reduce((t,l)=>t+l.quantidade,0)},formatPrice(e){return e=k.formatReal(e),e},updateTotalGeral(){console.log("Método chamado"),this.totalGeral=this.currentItem.projetoProdutos.reduce((e,t)=>{var m;console.log("Produto 1: ",t);const l=parseFloat(t.quantidade)||0;console.log("Quantidade: ",l);const s=parseFloat((m=t.produto)==null?void 0:m.precoMedio)||0;return console.log("Preço Médio: ",s),e+s*l},0).toFixed(2)},addItem(){this.currentItem.projetoProdutos.push({produto:{descricao:"",epecificacao:"",precoMedio:0,unidade:""},quantidade:0,inicioEntrega:null,fimEntrega:null,total:0}),this.updateTotalGeral()},removeItem(e){this.currentItem.projetoProdutos&&this.currentItem.projetoProdutos.length>e&&(this.currentItem.projetoProdutos.splice(e,1),this.updateTotalGeral(),this.validateQuantity())},resetState(){Object.keys(this.currentItem).forEach(e=>{this.currentItem[e]=null})},async localOnSubmit(){try{const e={...this.currentItem,projetoProdutos:this.currentItem.projetoProdutos};console.log(e),this.onSubmit(e)}catch(e){console.log("Erro: ",e)}},async getProducts(){try{const e=await v.get("/public/produtos");console.log(e.data),Array.isArray(e.data)?(this.products=e.data,console.log(e.data)):(console.log("A resposta da API não é um Array"),this.products=[])}catch(e){console.log("Error: ",e),this.products=[]}},async getResearchs(){try{const e=await v.get("/public/pesquisas");console.log(e.data),Array.isArray(e.data)?(this.researchs=e.data,console.log(e.data)):(console.log("A resposta da API não é um Array"),this.researchs=[])}catch(e){console.log("Error: ",e),this.researchs=[]}},async getProductors(){try{const e=await v.get("/public/produtores");console.log(e.data),this.producers=e.data}catch(e){console.log("Error: ",e),this.producers=[]}},async getProjects(){try{const e=await v.get(`/public/projetos/projeto/${this.currentItem.produtor.id}`);console.log(e.data);const{projetoProdutos:t}=e.data;this.projects=[...t],console.log(this.projects)}catch(e){console.error("Error: ",e),this.projects=[]}}},mounted(){this.getProducts(),this.getProductors(),this.getResearchs(),this.updateTotalGeral(),this.getProjects()}},ut={class:"pa-3 pr-12 pl-12"},mt={class:"grid-container"},pt={class:"mt-3"},ct={class:"mt-3 ml-3 mr-3"},ft={key:2,class:"text-start text-error ml-3",style:{"font-size":"0.8rem","font-weight":"bold",width:"100%","margin-top":"-25px","margin-bottom":"20px"}};function gt(e,t,l,s,m,d){const j=w("vuetify-money"),D=w("ConfirmButton");return y(),P("div",ut,[a(W,{onSubmit:G(d.localOnSubmit,["prevent"]),ref:"formRef"},{default:o(()=>[r("div",mt,[a(b,{class:"ml-1 w-100"},{default:o(()=>[a(i,{cols:"12"},{default:o(()=>[a(M,{density:"compact",name:"producer",items:e.producers,"item-title":"nome","item-value":"id","return-object":"",modelValue:l.currentItem.produtor,"onUpdate:modelValue":t[0]||(t[0]=p=>l.currentItem.produtor=p),variant:"outlined",rules:e.requiredField,clearable:""},{label:o(()=>t[2]||(t[2]=[r("span",null,[u("Produtor "),r("span",{style:{color:"red"}},"*")],-1)])),_:1},8,["items","modelValue","rules"])]),_:1})]),_:1}),a(b,{class:"w-100",style:{"margin-top":"-50px","margin-left":"-8px"}},{default:o(()=>[a(i,{cols:"12"},{default:o(()=>[a(I,{size:"30px",icon:"",style:{"margin-left":"-26px","margin-bottom":"-85px"},color:"primary",onClick:d.addItem},{default:o(()=>[a(h,{left:"",size:"20px"},{default:o(()=>t[3]||(t[3]=[u("mdi-plus")])),_:1})]),_:1},8,["onClick"]),(y(!0),P(U,null,z(l.currentItem.projetoProdutos,(p,c)=>(y(),P("div",{key:c,class:"grid-second-container"},[a(i,{cols:"3",class:""},{default:o(()=>[a(M,{color:e.isDuplicate?"error":"",density:"compact",items:e.products,"item-title":"descricao","item-value":"id","return-object":"",modelValue:p.produto,"onUpdate:modelValue":f=>p.produto=f,variant:"outlined",rules:e.requiredField,clearable:""},{label:o(()=>t[4]||(t[4]=[r("span",null,[u("Produto "),r("span",{style:{color:"red"}},"*")],-1)])),_:2},1032,["color","items","modelValue","onUpdate:modelValue","rules"])]),_:2},1024),a(i,{cols:"1"},{default:o(()=>[a(V,{density:"compact",label:"Unidade",modelValue:p.produto.unidade,"onUpdate:modelValue":f=>p.produto.unidade=f,variant:"outlined",disabled:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(i,{cols:"2"},{default:o(()=>[a(V,{density:"compact",label:"Preço Médio",modelValue:p.produto.precoMedio,"onUpdate:modelValue":f=>p.produto.precoMedio=f,variant:"outlined",disabled:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(i,{cols:"1"},{default:o(()=>[a(j,{density:"compact",label:"Quantidade",options:e.options,modelValue:p.quantidade,"onUpdate:modelValue":f=>p.quantidade=f,variant:"outlined",disabled:e.isDuplicate},null,8,["options","modelValue","onUpdate:modelValue","disabled"])]),_:2},1024),r("div",pt,[a(V,{density:"compact",name:"inicioEntrega",label:"De",type:"date",modelValue:p.inicioEntrega,"onUpdate:modelValue":f=>p.inicioEntrega=f,variant:"outlined",rules:e.requiredField},null,8,["modelValue","onUpdate:modelValue","rules"])]),r("div",ct,[a(V,{density:"compact",name:"fimEntrega",label:"Até",type:"date",modelValue:p.fimEntrega,"onUpdate:modelValue":f=>p.fimEntrega=f,variant:"outlined",rules:e.requiredField,"hide-details":!1},null,8,["modelValue","onUpdate:modelValue","rules"])]),l.currentItem.projetoProdutos.length>1?(y(),F(I,{key:0,size:"30px",icon:"",color:"error",style:{"margin-top":"15px"},onClick:f=>d.removeItem(c)},{default:o(()=>[a(h,{size:"20px"},{default:o(()=>t[5]||(t[5]=[u("mdi-delete")])),_:1})]),_:2},1032,["onClick"])):C("",!0),e.quantityWarnings[c]?(y(),F(x,{key:1,color:"error",class:"mt-2 mb-6 ml-4",density:"compact",style:{"font-size":"0.7rem",height:"80px","font-weight":"bold"}},{default:o(()=>[u(n(e.quantityWarnings[c]),1)]),_:2},1024)):C("",!0),e.isDuplicate?(y(),P("span",ft,n("Itens duplicados. Por favor, remova-os, ou escolha outro."))):C("",!0)]))),128))]),_:1})]),_:1}),a(b,{class:"w-100",style:{"margin-top":"15px","margin-left":"3px"}},{default:o(()=>[a(i,{cols:"4"},{default:o(()=>[a(E,{location:"end"},{activator:o(({props:p})=>[a(V,A(p,{"max-width":"170px",density:"compact",name:"dataProjeto",label:"Data do Projeto",type:"date",modelValue:l.currentItem.dataProjeto,"onUpdate:modelValue":t[1]||(t[1]=c=>l.currentItem.dataProjeto=c),variant:"outlined",rules:e.requiredField}),null,16,["modelValue","rules"])]),default:o(()=>[t[6]||(t[6]=r("span",null,"Obs: Utilizar a data de realização da Chamada Pública",-1))]),_:1})]),_:1}),a(i,{align:"end",class:"align-self-center"},{default:o(()=>[t[7]||(t[7]=r("h4",null,"Total",-1)),r("span",null,n(d.formatPrice(e.totalGeral)),1)]),_:1})]),_:1})])]),_:1},8,["onSubmit"]),a(b,{class:"justify-end dense pt-6"},{default:o(()=>[a(i,{class:"text-end"},{default:o(()=>[a(E,{location:"top",disabled:d.isFormValid},{activator:o(({props:p})=>[r("span",L(Y(p)),[a(D,{color:d.isFormValid?"success":"grey",onConfirm:d.localOnSubmit,loading:e.isSubmitting,disabled:!d.isFormValid||e.isSubmitting},{default:o(()=>t[8]||(t[8]=[u("Salvar")])),_:1},8,["color","onConfirm","loading","disabled"])],16)]),default:o(()=>[t[9]||(t[9]=r("span",null,"Preencha todos os campos obrigatórios (*) para habilitar o botão",-1))]),_:1},8,["disabled"])]),_:1})]),_:1})])}const yt=R(nt,[["render",gt],["__scopeId","data-v-a4aafc2b"]]),ht={name:"ProdutorExpand",props:{projetoData:Object},data:()=>({productors:[],headers:[{title:"Arquivo",align:"start",sortable:!0,value:"fileName"},{title:"Tipo",align:"start",sortable:!0,value:"fileType"},{title:"Baixar",align:"start",sortable:!0,value:"download"},{title:"Remover",align:"start",sortable:!0,value:"remove"}]}),methods:{age(e){console.log("Método chamado");const t=new Date,l=new Date(e);let s=t.getFullYear()-l.getFullYear();const m=t.getMonth()-l.getMonth();return(m<0||m===0&&t.getDate()<l.getDate())&&s--,console.log(s),s},formatDate(e){return k.formatDateBr(e)},formatPrice(e){return e=k.formatReal(e),e},getAge(){var m;const e=new Date,t=new Date((m=this.projetoData)==null?void 0:m.dataNascimento);let l=e.getFullYear()-t.getFullYear();const s=e.getMonth()-t.getMonth();(s<0||s===0&&e.getDate()<t.getDate())&&l--,this.projetoData.dataNascimento=l},downloadFile(e){const t=`http://localhost:8080/document/download/${e==null?void 0:e.fileName}`,l=document.createElement("a");l.href=t,l.download=e.fileName,document.body.appendChild(l),l.click(),document.body.removeChild(l)},async deleteFile(e){const t=S();console.log("Id do arquivo: ",e.id);try{const l=await v.delete(`/document/delete/${e.id}/${this.projetoData.id}`);if(l.status!==204)throw new Error("Erro: ",l.status);t.success("Arquivo removido com sucesso!")}catch(l){t.error("Erro ao remover arquivo: ",l)}},async getProductors(){try{const e=await v.get("/public/produtores");console.log(e.data),Array.isArray(e.data)?this.productors=e.data:(console.log("A resposta da API não é um Array"),this.productors=[])}catch(e){console.log("Error: ",e),this.productors=[]}}},mounted(){this.getAge()}},bt={align:"start",class:"pa-2"},Pt={class:"d-flex flex-wrap flex-column mr-16",style:{height:"175px",border:"2px solid white",width:"390px"},align:"start"},vt={class:"pl-3 pt-2",style:{"margin-right":"-100px","font-weight":"bold",width:"150px"}},Vt={class:"d-flex container mt-2",align:"start",style:{width:"100%",height:"100%"}},jt={align:"start",class:"pa-2"},wt={align:"start",class:"pa-2"},It={align:"start",class:"pa-2"},Dt={align:"start",class:"pa-2"};function Et(e,t,l,s,m,d){return y(),P(U,null,[t[35]||(t[35]=r("h3",{class:"mt-2 mb-2"},"Detalhes do Projeto",-1)),a(b,{dense:"",style:{height:"100px"},class:"border-md pa-2"},{default:o(()=>[a(i,{cols:"2",align:"start",class:"h-75"},{default:o(()=>[t[0]||(t[0]=r("h4",null,"Data do Projeto:",-1)),r("p",null,n(d.formatDate(l.projetoData.dataProjeto)),1)]),_:1}),a(i,{cols:"2",align:"start",class:"h-75"},{default:o(()=>[t[1]||(t[1]=r("h4",null,"Qtd de Produtos:",-1)),r("p",null,n(l.projetoData.projetoProdutos.length),1)]),_:1}),a(i,{cols:"1",align:"start",class:"h-75"},{default:o(()=>[t[2]||(t[2]=r("h4",null,"Total Geral:",-1)),r("p",null,n(d.formatPrice(l.projetoData.total)),1)]),_:1})]),_:1}),r("h4",bt,[t[4]||(t[4]=u(" Dados do Produto ")),a(h,null,{default:o(()=>t[3]||(t[3]=[u("mdi-file-account")])),_:1})]),a(b,{dense:"",style:{height:"200px"},class:"border-md pa-2"},{default:o(()=>[(y(!0),P(U,null,z(l.projetoData.projetoProdutos,(j,D)=>(y(),F(i,{key:D,cols:"2",class:"d-flex flex-wrap flex-column mr-16 h-50"},{default:o(()=>[r("div",Pt,[r("p",vt,"Produto "+n(D+1),1),r("div",Vt,[a(i,{cols:"12",class:"mt-6 pt-2 container",align:"start",style:{"margin-left":"-50px"}},{default:o(()=>[t[5]||(t[5]=r("span",{style:{"font-weight":"bold"}},"Descrição:",-1)),r("p",null,n(j.produto.descricao),1),t[6]||(t[6]=r("br",null,null,-1)),t[7]||(t[7]=r("span",null,"Unidade:",-1)),r("p",null,n(j.produto.unidade),1)]),_:2},1024),a(i,{cols:"9",align:"start",class:"mt-5 container",style:{"margin-left":"-130px"}},{default:o(()=>[t[8]||(t[8]=r("span",{style:{"font-weight":"bold"}},"Preço Médio:",-1)),r("p",null,n(d.formatPrice(j.produto.precoMedio)),1),t[9]||(t[9]=r("br",null,null,-1)),t[10]||(t[10]=r("span",null,"Quantidade:",-1)),r("p",null,n(j.quantidade),1)]),_:2},1024)])])]),_:2},1024))),128))]),_:1}),r("h4",jt,[t[12]||(t[12]=u(" Dados do Produtor ")),a(h,null,{default:o(()=>t[11]||(t[11]=[u("mdi-file-account")])),_:1})]),a(b,{dense:"",style:{height:"150px"},class:"border-md pa-2"},{default:o(()=>[a(i,{cols:"3",align:"start",class:"h-50"},{default:o(()=>[t[13]||(t[13]=r("h4",null,"Nome:",-1)),r("p",null,n(l.projetoData.produtor.nome),1)]),_:1}),a(i,{cols:"1",align:"start",class:"h-50"},{default:o(()=>[t[14]||(t[14]=r("h4",null,"Idade:",-1)),r("p",null,n(d.age(l.projetoData.produtor.dataNascimento)),1)]),_:1}),a(i,{cols:"3",align:"start",class:"h-50"},{default:o(()=>[t[15]||(t[15]=r("h4",null,"Email:",-1)),r("p",null,n(l.projetoData.produtor.email),1)]),_:1}),a(i,{cols:"2",align:"start",class:"h-50"},{default:o(()=>[t[16]||(t[16]=r("h4",null,"Contato:",-1)),r("p",null,n(l.projetoData.produtor.contato),1)]),_:1}),a(i,{cols:"2",align:"start",class:"h-50"},{default:o(()=>[t[17]||(t[17]=r("h4",null,"CPF:",-1)),r("p",null,n(l.projetoData.produtor.cpf),1)]),_:1}),a(i,{cols:"2",align:"start",class:"h-50"},{default:o(()=>[t[18]||(t[18]=r("h4",null,"RG:",-1)),r("p",null,n(l.projetoData.produtor.rg),1)]),_:1})]),_:1}),r("h4",wt,[t[20]||(t[20]=u(" Endereço ")),a(h,null,{default:o(()=>t[19]||(t[19]=[u("mdi-home")])),_:1})]),a(b,{dense:"",style:{height:"100px"},class:"border-md pa-2"},{default:o(()=>[a(i,{cols:"1",align:"start",class:"h-75"},{default:o(()=>[t[21]||(t[21]=r("h4",null,"Estado:",-1)),r("p",null,n(l.projetoData.produtor.estado),1)]),_:1}),a(i,{cols:"2",align:"start",class:"h-75"},{default:o(()=>[t[22]||(t[22]=r("h4",null,"Município:",-1)),r("p",null,n(l.projetoData.produtor.municipio),1)]),_:1}),a(i,{cols:"3",align:"start",class:"h-75"},{default:o(()=>[t[23]||(t[23]=r("h4",null,"Endereço:",-1)),r("p",null,n(l.projetoData.produtor.endereco),1)]),_:1}),a(i,{cols:"1",align:"start",class:"h-75"},{default:o(()=>[t[24]||(t[24]=r("h4",null,"CEP:",-1)),r("p",null,n(l.projetoData.produtor.cep),1)]),_:1})]),_:1}),r("h4",It,[t[26]||(t[26]=u(" Dados Bancários ")),a(h,null,{default:o(()=>t[25]||(t[25]=[u("mdi-bank")])),_:1})]),a(b,{dense:"",style:{height:"100px",width:"50vw"},class:"border-md pa-2"},{default:o(()=>[a(i,{cols:"3",align:"start",class:"h-75"},{default:o(()=>[t[27]||(t[27]=r("h4",null,"Banco:",-1)),r("p",null,n(l.projetoData.produtor.banco),1)]),_:1}),a(i,{cols:"2",align:"start",class:"h-75"},{default:o(()=>[t[28]||(t[28]=r("h4",null,"Agência:",-1)),r("p",null,n(l.projetoData.produtor.agencia),1)]),_:1}),a(i,{cols:"3",align:"start",class:"h-75"},{default:o(()=>[t[29]||(t[29]=r("h4",null,"Tipo de Conta:",-1)),r("p",null,n(l.projetoData.produtor.tipoConta),1)]),_:1}),a(i,{cols:"2",align:"start",class:"h-75"},{default:o(()=>[t[30]||(t[30]=r("h4",null,"Conta:",-1)),r("p",null,n(l.projetoData.produtor.conta),1)]),_:1})]),_:1}),r("h4",Dt,[t[32]||(t[32]=u(" Dados da CAF ")),a(h,null,{default:o(()=>t[31]||(t[31]=[u("mdi-text-box-multiple-outline")])),_:1})]),a(b,{dense:"",style:{height:"120px",width:"50vw"},class:"border-md pa-2 mb-2"},{default:o(()=>[a(i,{cols:"3",align:"start",class:"h-75"},{default:o(()=>[t[33]||(t[33]=r("h4",null,"CAF:",-1)),r("p",null,n(l.projetoData.produtor.caf),1)]),_:1}),a(i,{cols:"2",align:"start",class:"h-75"},{default:o(()=>[t[34]||(t[34]=r("h4",null,"Validade da CAF:",-1)),r("p",null,n(d.formatDate(l.projetoData.produtor.validadeCaf)),1)]),_:1})]),_:1})],64)}const qt=R(ht,[["render",Et],["__scopeId","data-v-de34be9c"]]),Ct={name:"CadastroProdutor",components:{NavBar:K,NovoProduto:it,ProjetoDeVendaExpand:qt,EditProjeto:yt,BtnComeBack:_,ConfirmButton:B},data:()=>({dialog:{create:!1,update:!1},search:"",singleExpand:!1,showFilters:!1,projects:[],headers:[{text:"Editar",align:"center",value:"edit",width:"40px"},{text:"Remover",align:"center",value:"delete",width:"40px"},{title:"Produtor",align:"center",sortable:!0,value:"produtor.nome"},{title:"Endereço",align:"center",sortable:!0,value:"produtor.endereco",width:"300px"},{title:"CAF",align:"center",sortable:!0,value:"produtor.caf"},{title:"Data Projeto",align:"center",sortable:!0,value:"dataProjeto"},{title:"Total Geral",align:"center",sortable:!0,value:"total"},{title:"Relatório",align:"center",sortable:!0,value:"download"}],newItem:{},selectedRow:{},deleteRow:{},expanded:[]}),computed:{filteredProjects(){return this.projects}},methods:{formatPrice(e){return e=k.formatReal(e),e},formatDate(e){return k.formatData(e)},downloadRelatorio(e){console.log("Método chamado");const t=`http://syssiae.ddns.net:8080/public/projetos/relatorio/generate/${e.id}`;window.location.href=t},async getProjects(){try{const e=await v.get("/public/projetos");console.log(e.data),Array.isArray(e.data)?this.projects=e.data:(console.log("A resposta da API não é um Array"),this.projects=[])}catch(e){console.log("Error: ",e),this.projects=[]}},async createProject(e){const t=S();console.log(e);try{const l=await v.post("/public/projetos/projeto",e);if(console.log(l.data),l.status!==201)throw new Error(`Erro: ${l.status}`);t.success("Projeto cadastrado com sucesso!")}catch(l){console.error("Erro: ",l),t.error("Erro ao cadastrar projeto: ",l)}finally{this.dialog.create=!1,this.getProjects()}},async updateProject(e){const t=S();try{const l=await v.put(`/public/projetos/projeto/${e.id}`,e);if(console.log(l.data),console.log(l),l.status!==200)throw new Error(`Erro: ${l.status}`);t.success("Projeto atualizado com sucesso!")}catch(l){console.error("Erro: ",l),t.error("Erro ao atualizar produto: ",l)}finally{this.dialog.update=!1,this.getProjects()}},async deleteProject(e){const t=S();try{const l=await v.delete(`/public/projetos/projeto/${e.id}`,e);if(l.status!==204)throw new Error("Erro: ",l.status);t.success("Projeto removido com sucesso!")}catch(l){t.error("Erro ao deletar produto: ",l),console.error("Erro: ",l)}finally{this.getProducts()}},onSelectRow(e,t){this.selectedRow={...e},this.dialog[t]=!0},onDeleteRow(e){console.log("Método chamado"),this.selectedRow={...e},this.deleteProject(this.selectedRow)},onDownloadRow(e){console.log("Método chamado"),this.selectedRow={...e},this.downloadRelatorio(this.selectedRow)}},mounted(){this.getProjects()}},Ft={colspan:9,style:{"background-color":"#37622a"},class:"text-white"};function At(e,t,l,s,m,d){const j=w("NavBar"),D=w("BtnComeBack"),p=w("ConfirmButton"),c=w("ProjetoDeVendaExpand"),f=w("NovoProduto"),H=w("EditProjeto");return y(),P(U,null,[a(j),a(D),t[23]||(t[23]=r("h1",{style:{color:"#57a340","margin-top":"10px",padding:"30px","font-size":"3rem"}},"Projeto De Venda",-1)),a(b,{justify:"center",class:"pr-2"},{default:o(()=>[a(i,{cols:"12"},{default:o(()=>[a(X,{items:d.filteredProjects,headers:e.headers,search:e.search,"single-expand":"","show-expand":"",expanded:e.expanded,"onUpdate:expanded":t[3]||(t[3]=g=>e.expanded=g),"fixed-header":!0,height:"700px"},{top:o(()=>[a(b,{class:"mt-2 mb-8 mx-3"},{default:o(()=>[a(i,{cols:"5"},{default:o(()=>[a(V,{class:"border rounded",dense:"",outlined:"","hide-details":"",modelValue:e.search,"onUpdate:modelValue":t[0]||(t[0]=g=>e.search=g),label:"Pesquisar","append-inner-icon":"mdi-magnify",clearable:""},null,8,["modelValue"])]),_:1}),a(i,{class:"text-end",cols:"2"},{default:o(()=>[a(Z,{location:"top start",bordered:"",overlap:""},{default:o(()=>[a(I,{class:"elevation-0",onClick:t[1]||(t[1]=g=>e.showFilters=!e.showFilters)},{default:o(()=>[e.showFilters?(y(),F(h,{key:1,left:"",size:"25px"},{default:o(()=>t[9]||(t[9]=[u("mdi-filter-off")])),_:1})):(y(),F(h,{key:0,size:"25px",left:""},{default:o(()=>t[8]||(t[8]=[u("mdi-filter")])),_:1})),t[10]||(t[10]=u(" FILTROS "))]),_:1})]),_:1})]),_:1}),a(i,{class:"button-group mr-4",align:"end"},{default:o(()=>[a(E,{top:""},{activator:o(({on:g,attrs:q})=>[a(I,A({color:"success",class:"elevation-3 compact-btn ml-3","min-width":"25%",onClick:t[2]||(t[2]=J=>e.dialog.create=!0)},q,$(g)),{default:o(()=>[a(h,{small:"",class:"compact-icon",left:""},{default:o(()=>t[11]||(t[11]=[u("mdi-plus")])),_:1}),t[12]||(t[12]=r("div",{class:"d-flex flex-column compact-btn-text",style:{"font-size":"0.6rem"}},[r("span",null,"Novo"),u(),r("span",null,"Projeto")],-1))]),_:2},1040)]),default:o(()=>[t[13]||(t[13]=r("span",null,"Clique para adicionar um projeto",-1))]),_:1})]),_:1})]),_:1})]),"item.edit":o(({item:g})=>[a(E,{location:"top"},{activator:o(({props:q})=>[a(I,A({icon:""},q,{onClick:J=>d.onSelectRow(g,"update"),class:"elevation-0"}),{default:o(()=>[a(h,{color:"green"},{default:o(()=>t[14]||(t[14]=[u("mdi-pencil")])),_:1})]),_:2},1040,["onClick"])]),default:o(()=>[t[15]||(t[15]=r("span",null,"Clique para editar um Projeto",-1))]),_:2},1024)]),"item.delete":o(({item:g})=>[a(E,{location:"top"},{activator:o(({props:q})=>[a(p,A({icon:""},q,{onConfirm:()=>d.onDeleteRow(g),class:"elevation-0"}),{default:o(()=>[a(h,{color:"red"},{default:o(()=>t[16]||(t[16]=[u("mdi-delete")])),_:1})]),_:2},1040,["onConfirm"])]),default:o(()=>[t[17]||(t[17]=r("span",null,"Clique para deletar um Projeto",-1))]),_:2},1024)]),"item.download":o(({item:g})=>[a(E,{location:"top"},{activator:o(({props:q})=>[a(p,A({icon:""},q,{onConfirm:()=>d.onDownloadRow(g),class:"elevation-0"}),{default:o(()=>[a(h,{color:"primary"},{default:o(()=>t[18]||(t[18]=[u("mdi-download")])),_:1})]),_:2},1040,["onConfirm"])]),default:o(()=>[t[19]||(t[19]=r("span",null,"Clique para deletar um Projeto",-1))]),_:2},1024)]),"item.dataProjeto":o(({item:g})=>[r("span",null,n(d.formatDate(g.dataProjeto)),1)]),"item.total":o(({item:g})=>[r("span",null,n(d.formatPrice(g.total)),1)]),"expanded-row":o(({item:g})=>[r("tr",null,[r("td",Ft,[u(n(console.log(g))+" ",1),a(c,{projetoData:g},null,8,["projetoData"])])])]),_:2},1032,["items","headers","search","expanded"]),a(N,{modelValue:e.dialog.create,"onUpdate:modelValue":t[5]||(t[5]=g=>e.dialog.create=g)},{default:o(()=>[a(Q,{class:"card-form align-self-center",width:"100%"},{default:o(()=>[a(T,{class:"sticky-title title-border"},{default:o(()=>[t[21]||(t[21]=u(" Cadastro de Projeto ")),a(O),a(I,{icon:"",class:"btn-close elevation-0",onClick:t[4]||(t[4]=g=>e.dialog.create=!e.dialog.create)},{default:o(()=>[a(h,{prepend:""},{default:o(()=>t[20]||(t[20]=[u(" mdi-close ")])),_:1})]),_:1})]),_:1}),a(f,{currentItem:e.newItem,onSubmit:d.createProject,dialogAtivo:e.dialog.create},null,8,["currentItem","onSubmit","dialogAtivo"])]),_:1})]),_:1},8,["modelValue"]),a(N,{modelValue:e.dialog.update,"onUpdate:modelValue":t[7]||(t[7]=g=>e.dialog.update=g)},{default:o(()=>[a(Q,{class:"card-form align-self-center",width:"75%"},{default:o(()=>[a(T,{class:"sticky-title title-border"},{default:o(()=>[u(" Editar Produtor: "+n(e.selectedRow.id)+" ",1),a(O),a(I,{icon:"",class:"btn-close elevation-0",onClick:t[6]||(t[6]=g=>e.dialog.update=!e.dialog.update)},{default:o(()=>[a(h,{prepend:""},{default:o(()=>t[22]||(t[22]=[u(" mdi-close ")])),_:1})]),_:1})]),_:1}),a(H,{currentItem:e.selectedRow,onSubmit:d.updateProject},null,8,["currentItem","onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})],64)}const Bt=R(Ct,[["render",At],["__scopeId","data-v-dfa809b9"]]);export{Bt as default};
